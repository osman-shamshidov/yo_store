#!/usr/bin/env python3
"""–°–∫—Ä–∏–ø—Ç –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö level2_descriptions —Å –æ–ø–∏—Å–∞–Ω–∏—è–º–∏ –∏–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"""

import sys
import json
from datetime import datetime
from sqlalchemy import create_engine, distinct
from sqlalchemy.orm import sessionmaker
from models import Product, Level2Description
from config import Config
import time

def search_product_info(product_name: str) -> tuple[str, dict]:
    """
    –ü–æ–∏—Å–∫ –æ–ø–∏—Å–∞–Ω–∏—è –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –ø—Ä–æ–¥—É–∫—Ç–∞
    –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç (–æ–ø–∏—Å–∞–Ω–∏–µ, —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏)
    """
    # –ë–∞–∑–æ–≤—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
    name_lower = product_name.lower()
    
    try:
        # –ò—Å–ø–æ–ª—å–∑—É–µ–º —É–ª—É—á—à–µ–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞
        description = f"{product_name} ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏."
        details = {}
            
        if 'iphone' in name_lower:
            if 'pro' in name_lower or 'max' in name_lower:
                description = f"{product_name} ‚Äî —Ñ–ª–∞–≥–º–∞–Ω—Å–∫–∏–π —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple —Å –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏, –º–æ—â–Ω—ã–º –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–æ–º –∏ –ø—Ä–µ–º–∏–∞–ª—å–Ω—ã–º–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º–∏."
                details = {
                    "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "iOS",
                    "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple A17 Pro –∏–ª–∏ –Ω–æ–≤–µ–µ",
                    "–î–∏—Å–ø–ª–µ–π": "Super Retina XDR OLED",
                    "–ö–∞–º–µ—Ä–∞": "–ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–º–µ—Ä",
                    "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã": "–¢–∏—Ç–∞–Ω –∏ —Å—Ç–µ–∫–ª–æ",
                    "–ó–∞—Ä—è–¥–∫–∞": "MagSafe, –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞"
                }
            else:
                description = f"{product_name} ‚Äî —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple —Å –æ—Ç–ª–∏—á–Ω—ã–º –±–∞–ª–∞–Ω—Å–æ–º —Ñ—É–Ω–∫—Ü–∏–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏."
                details = {
                    "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "iOS",
                    "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple A17 –∏–ª–∏ –Ω–æ–≤–µ–µ",
                    "–î–∏—Å–ø–ª–µ–π": "Super Retina XDR OLED",
                    "–ö–∞–º–µ—Ä–∞": "–°–∏—Å—Ç–µ–º–∞ –∫–∞–º–µ—Ä —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π",
                    "–ú–∞—Ç–µ—Ä–∏–∞–ª—ã": "–ê–ª—é–º–∏–Ω–∏–π –∏ —Å—Ç–µ–∫–ª–æ",
                    "–ó–∞—Ä—è–¥–∫–∞": "MagSafe, –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞"
                }
        elif 'macbook' in name_lower or 'mac' in name_lower:
            description = f"{product_name} ‚Äî –Ω–æ—É—Ç–±—É–∫ Apple —Å —á–∏–ø–æ–º Apple Silicon, –¥–ª–∏—Ç–µ–ª—å–Ω–æ–π –∞–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å—é –∏ —è—Ä–∫–∏–º –¥–∏—Å–ø–ª–µ–µ–º."
            details = {
                "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "macOS",
                "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple Silicon (M-series)",
                "–î–∏—Å–ø–ª–µ–π": "Liquid Retina, True Tone",
                "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä": "–î–æ 18 —á–∞—Å–æ–≤ –∞–≤—Ç–æ–Ω–æ–º–Ω–æ–π —Ä–∞–±–æ—Ç—ã",
                "–ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞": "Magic Keyboard —Å –ø–æ–¥—Å–≤–µ—Ç–∫–æ–π",
                "–ü–æ—Ä—Ç—ã": "USB-C / Thunderbolt 4"
            }
        elif 'ipad' in name_lower:
            description = f"{product_name} ‚Äî –ø–ª–∞–Ω—à–µ—Ç Apple –¥–ª—è —Ä–∞–±–æ—Ç—ã –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–∞ —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π Apple Pencil."
            details = {
                "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "iPadOS",
                "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple A-series –∏–ª–∏ M-series",
                "–î–∏—Å–ø–ª–µ–π": "Liquid Retina",
                "–ü–æ–¥–¥–µ—Ä–∂–∫–∞": "Apple Pencil, Magic Keyboard",
                "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä": "–î–æ 10 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã"
            }
        elif 'airpods' in name_lower:
            description = f"{product_name} ‚Äî –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏ Apple —Å –∞–∫—Ç–∏–≤–Ω—ã–º —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ–º –∏ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º."
            details = {
                "–¢–∏–ø": "–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–µ –Ω–∞—É—à–Ω–∏–∫–∏",
                "–®—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ": "–ê–∫—Ç–∏–≤–Ω–æ–µ —à—É–º–æ–ø–æ–¥–∞–≤–ª–µ–Ω–∏–µ",
                "–ó–≤—É–∫": "–ü—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–≤—É–∫",
                "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä": "–î–æ 6 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã",
                "–ö–µ–π—Å": "MagSafe –∑–∞—Ä—è–¥–∫–∞"
            }
        elif 'homepod' in name_lower:
            description = f"{product_name} ‚Äî —É–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ Apple —Å –≤—ã—Å–æ–∫–∏–º –∫–∞—á–µ—Å—Ç–≤–æ–º –∑–≤—É–∫–∞ –∏ –≥–æ–ª–æ—Å–æ–≤—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º Siri."
            details = {
                "–¢–∏–ø": "–£–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞",
                "–ó–≤—É–∫": "–í—ã—Å–æ–∫–æ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞",
                "–ü–æ–º–æ—â–Ω–∏–∫": "Siri",
                "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ": "Wi-Fi, AirPlay"
            }
        elif 'watch' in name_lower:
            description = f"{product_name} ‚Äî —É–º–Ω—ã–µ —á–∞—Å—ã Apple —Å —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–º–∏ —Ñ—É–Ω–∫—Ü–∏—è–º–∏ –∑–¥–æ—Ä–æ–≤—å—è –∏ —Ñ–∏—Ç–Ω–µ—Å–∞."
            details = {
                "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "watchOS",
                "–î–∏—Å–ø–ª–µ–π": "Always-On Retina",
                "–ó–¥–æ—Ä–æ–≤—å–µ": "–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∑–¥–æ—Ä–æ–≤—å—è –∏ —Ñ–∏—Ç–Ω–µ—Å–∞",
                "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä": "–î–æ 18 —á–∞—Å–æ–≤ —Ä–∞–±–æ—Ç—ã"
            }
        elif 'samsung' in name_lower:
            if 'galaxy' in name_lower:
                description = f"{product_name} ‚Äî —Å–º–∞—Ä—Ç—Ñ–æ–Ω Samsung —Å –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏ –∏ –æ—Ç–ª–∏—á–Ω—ã–º–∏ –∫–∞–º–µ—Ä–∞–º–∏."
                details = {
                    "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "Android",
                    "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Snapdragon –∏–ª–∏ Exynos",
                    "–î–∏—Å–ø–ª–µ–π": "Dynamic AMOLED",
                    "–ö–∞–º–µ—Ä–∞": "–ú–Ω–æ–≥–æ–º–æ–¥—É–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫–∞–º–µ—Ä",
                    "–ó–∞—Ä—è–¥–∫–∞": "–ë—ã—Å—Ç—Ä–∞—è –∑–∞—Ä—è–¥–∫–∞, –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–∞—è –∑–∞—Ä—è–¥–∫–∞"
                }
        elif 'sony' in name_lower or 'ps5' in name_lower or 'playstation' in name_lower:
            if 'dualsense' in name_lower:
                description = f"{product_name} ‚Äî –±–µ—Å–ø—Ä–æ–≤–æ–¥–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä –¥–ª—è PlayStation 5 —Å —Ç–∞–∫—Ç–∏–ª—å–Ω–æ–π –æ–±—Ä–∞—Ç–Ω–æ–π —Å–≤—è–∑—å—é –∏ –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–º–∏ —Ç—Ä–∏–≥–≥–µ—Ä–∞–º–∏."
                details = {
                    "–¢–∏–ø": "–ò–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä",
                    "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ": "–ë–µ—Å–ø—Ä–æ–≤–æ–¥–Ω–æ–µ (Bluetooth, USB-C)",
                    "–û–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å": "–¢–∞–∫—Ç–∏–ª—å–Ω–∞—è –æ–±—Ä–∞—Ç–Ω–∞—è —Å–≤—è–∑—å, –∞–¥–∞–ø—Ç–∏–≤–Ω—ã–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã",
                    "–ê–∫–∫—É–º—É–ª—è—Ç–æ—Ä": "–í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –∞–∫–∫—É–º—É–ª—è—Ç–æ—Ä",
                    "–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å": "PlayStation 5, PC"
                }
            elif 'slim' in name_lower:
                if 'digital' in name_lower:
                    description = f"{product_name} ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Å–æ–ª–∏ Sony PlayStation 5 –±–µ–∑ –¥–∏—Å–∫–æ–≤–æ–¥–∞."
                    details = {
                        "–¢–∏–ø": "–ò–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å",
                        "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "AMD Zen 2",
                        "–ì—Ä–∞—Ñ–∏–∫–∞": "AMD RDNA 2",
                        "–•—Ä–∞–Ω–∏–ª–∏—â–µ": "SSD 1TB",
                        "–§–æ—Ä–º–∞—Ç": "Digital Edition (–±–µ–∑ –¥–∏—Å–∫–æ–≤–æ–¥–∞)",
                        "–ò–≥—Ä—ã": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PS5 –∏ PS4 –∏–≥—Ä"
                    }
                else:
                    description = f"{product_name} ‚Äî –∫–æ–º–ø–∞–∫—Ç–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Å–æ–ª–∏ Sony PlayStation 5 —Å –¥–∏—Å–∫–æ–≤–æ–¥–æ–º."
                    details = {
                        "–¢–∏–ø": "–ò–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å",
                        "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "AMD Zen 2",
                        "–ì—Ä–∞—Ñ–∏–∫–∞": "AMD RDNA 2",
                        "–•—Ä–∞–Ω–∏–ª–∏—â–µ": "SSD 1TB",
                        "–§–æ—Ä–º–∞—Ç": "–° –¥–∏—Å–∫–æ–≤–æ–¥–æ–º Ultra HD Blu-ray",
                        "–ò–≥—Ä—ã": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PS5 –∏ PS4 –∏–≥—Ä"
                    }
            elif 'pro' in name_lower:
                description = f"{product_name} ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–≥—Ä–æ–≤–æ–π –∫–æ–Ω—Å–æ–ª–∏ Sony PlayStation 5 —Å —É–ª—É—á—à–µ–Ω–Ω–æ–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é."
                details = {
                    "–¢–∏–ø": "–ò–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å",
                    "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "AMD Zen 2 (—É–ª—É—á—à–µ–Ω–Ω—ã–π)",
                    "–ì—Ä–∞—Ñ–∏–∫–∞": "AMD RDNA 2 (—É–ª—É—á—à–µ–Ω–Ω–∞—è)",
                    "–•—Ä–∞–Ω–∏–ª–∏—â–µ": "SSD —É–≤–µ–ª–∏—á–µ–Ω–Ω–æ–≥–æ –æ–±—ä–µ–º–∞",
                    "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å": "–ü–æ–≤—ã—à–µ–Ω–Ω–∞—è —á–∞—Å—Ç–æ—Ç–∞ –∫–∞–¥—Ä–æ–≤ –∏ —Ä–∞–∑—Ä–µ—à–µ–Ω–∏–µ",
                    "–ò–≥—Ä—ã": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PS5 –∏ PS4 –∏–≥—Ä"
                }
            else:
                description = f"{product_name} ‚Äî –∏–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å Sony —Å –º–æ—â–Ω–æ–π –≥—Ä–∞—Ñ–∏–∫–æ–π –∏ –æ–±—à–∏—Ä–Ω–æ–π –±–∏–±–ª–∏–æ—Ç–µ–∫–æ–π –∏–≥—Ä."
                details = {
                    "–¢–∏–ø": "–ò–≥—Ä–æ–≤–∞—è –∫–æ–Ω—Å–æ–ª—å",
                    "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "AMD Zen 2",
                    "–ì—Ä–∞—Ñ–∏–∫–∞": "AMD RDNA 2",
                    "–•—Ä–∞–Ω–∏–ª–∏—â–µ": "SSD –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏",
                    "–ò–≥—Ä—ã": "–ü–æ–¥–¥–µ—Ä–∂–∫–∞ PS5 –∏ PS4 –∏–≥—Ä"
                }
        elif '—è–Ω–¥–µ–∫—Å' in name_lower or 'yandex' in name_lower:
            if '—Å—Ç–∞–Ω—Ü–∏—è' in name_lower and '–º–∏–Ω–∏' in name_lower:
                description = f"{product_name} ‚Äî —É–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –ê–ª–∏—Å–æ–π –∏ –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–º –∑–≤—É–∫–æ–º."
                details = {
                    "–¢–∏–ø": "–£–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞",
                    "–ü–æ–º–æ—â–Ω–∏–∫": "–ê–ª–∏—Å–∞ (–≥–æ–ª–æ—Å–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –Ø–Ω–¥–µ–∫—Å–∞)",
                    "–ó–≤—É–∫": "–ö–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–≤—É–∫",
                    "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ": "Wi-Fi, Bluetooth",
                    "–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ": "–ì–æ–ª–æ—Å–æ–≤–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ, —É–º–Ω—ã–π –¥–æ–º"
                }
            else:
                description = f"{product_name} ‚Äî —É–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞ –æ—Ç –Ø–Ω–¥–µ–∫—Å–∞ —Å –≥–æ–ª–æ—Å–æ–≤—ã–º –ø–æ–º–æ—â–Ω–∏–∫–æ–º –ê–ª–∏—Å–æ–π."
                details = {
                    "–¢–∏–ø": "–£–º–Ω–∞—è –∫–æ–ª–æ–Ω–∫–∞",
                    "–ü–æ–º–æ—â–Ω–∏–∫": "–ê–ª–∏—Å–∞",
                    "–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ": "Wi-Fi, Bluetooth"
                }
        else:
            # –û–±—â–µ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
            description = f"{product_name} ‚Äî –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏."
            details = {
                "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
                "–ë—Ä–µ–Ω–¥": "–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å"
            }
        
        return description, details
    except Exception as e:
        print(f"   ‚ö†Ô∏è –û—à–∏–±–∫–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∏ {product_name}: {e}")
        return generate_basic_description(product_name)

def generate_basic_description(product_name: str) -> tuple[str, dict]:
    """–ì–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç –±–∞–∑–æ–≤–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –ø—Ä–æ–¥—É–∫—Ç–∞"""
    name_lower = product_name.lower()
    
    description = f"{product_name} ‚Äî —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ —Å –ø–µ—Ä–µ–¥–æ–≤—ã–º–∏ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏—è–º–∏."
    details = {
        "–ö–∞—Ç–µ–≥–æ—Ä–∏—è": "–≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞",
        "–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å": "–ü—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–π –±—Ä–µ–Ω–¥"
    }
    
    if 'iphone' in name_lower:
        description = f"{product_name} ‚Äî —Å–º–∞—Ä—Ç—Ñ–æ–Ω Apple —Å –æ—Ç–ª–∏—á–Ω—ã–º–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º–∏."
        details = {
            "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "iOS",
            "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple A-series",
            "–î–∏—Å–ø–ª–µ–π": "OLED",
            "–ö–∞–º–µ—Ä–∞": "–°–∏—Å—Ç–µ–º–∞ –∫–∞–º–µ—Ä"
        }
    elif 'macbook' in name_lower:
        description = f"{product_name} ‚Äî –Ω–æ—É—Ç–±—É–∫ Apple —Å —á–∏–ø–æ–º Apple Silicon."
        details = {
            "–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞": "macOS",
            "–ü—Ä–æ—Ü–µ—Å—Å–æ—Ä": "Apple Silicon",
            "–î–∏—Å–ø–ª–µ–π": "Retina"
        }
    
    return description, details

def main():
    """–û—Å–Ω–æ–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è"""
    engine = create_engine(Config.DATABASE_URL)
    Session = sessionmaker(bind=engine)
    db = Session()
    
    try:
        # –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ level_2 –∏–∑ products
        print("üîç –ü–æ–∏—Å–∫ –≤—Å–µ—Ö level_2 –≤ —Ç–∞–±–ª–∏—Ü–µ products...")
        level2_products = db.query(Product.level_2).filter(
            Product.level_2.isnot(None)
        ).distinct().all()
        all_level2 = [row[0] for row in level2_products]
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(all_level2)} —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö level_2")
        
        # –ü–æ–ª—É—á–∞–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ level_2 –∏–∑ level2_descriptions
        print("üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π...")
        existing_level2 = {row[0] for row in db.query(Level2Description.level_2).all()}
        print(f"   ‚úÖ –ù–∞–π–¥–µ–Ω–æ {len(existing_level2)} —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –æ–ø–∏—Å–∞–Ω–∏–π")
        
        # –ù–∞—Ö–æ–¥–∏–º –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ
        missing_level2 = [lv for lv in all_level2 if lv not in existing_level2]
        print(f"   üìã –ù–∞–π–¥–µ–Ω–æ {len(missing_level2)} –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏—Ö level_2")
        
        if not missing_level2:
            print("‚úÖ –í—Å–µ level_2 —É–∂–µ –∏–º–µ—é—Ç –æ–ø–∏—Å–∞–Ω–∏—è!")
            return
        
        print("\nüìù –ù–∞—á–∏–Ω–∞–µ–º –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –æ–ø–∏—Å–∞–Ω–∏–π...")
        created = 0
        updated = 0
        
        for i, level2 in enumerate(missing_level2, 1):
            print(f"\n[{i}/{len(missing_level2)}] –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º: {level2}")
            
            try:
                # –ò—â–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–µ
                description, details = search_product_info(level2)
                
                # –°–æ–∑–¥–∞–µ–º –∑–∞–ø–∏—Å—å
                level2_desc = Level2Description(
                    level_2=level2,
                    description=description,
                    details=json.dumps(details, ensure_ascii=False),
                    created_at=datetime.utcnow(),
                    updated_at=datetime.utcnow()
                )
                
                db.add(level2_desc)
                created += 1
                
                print(f"   ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –æ–ø–∏—Å–∞–Ω–∏–µ –¥–ª—è {level2}")
                print(f"      –û–ø–∏—Å–∞–Ω–∏–µ: {description[:80]}...")
                print(f"      –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏: {len(details)} –ø–æ–ª–µ–π")
                
                # –ù–µ–±–æ–ª—å—à–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
                time.sleep(1)
                
            except Exception as e:
                print(f"   ‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ {level2}: {e}")
                db.rollback()
                continue
        
        # –ö–æ–º–º–∏—Ç–∏–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        if created > 0:
            db.commit()
            print(f"\n‚úÖ –£—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ {created} –æ–ø–∏—Å–∞–Ω–∏–π!")
        else:
            print("\n‚ö†Ô∏è –ù–µ –±—ã–ª–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ –Ω–∏ –æ–¥–Ω–æ–≥–æ –æ–ø–∏—Å–∞–Ω–∏—è")
        
    except Exception as e:
        print(f"\n‚ùå –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞: {e}")
        db.rollback()
        raise
    finally:
        db.close()

if __name__ == "__main__":
    main()

