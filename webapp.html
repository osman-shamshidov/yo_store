<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <title>Yo Store - –ú–∞–≥–∞–∑–∏–Ω —ç–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∏</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            color: #333;
            overflow-x: hidden;
            width: 100%;
            margin: 0;
            padding: 0;
        }
        
        html {
            width: 100%;
            overflow-x: hidden;
            margin: 0;
            padding: 0;
        }
        
        .container {
            max-width: 1200px;
            width: 100%;
            margin: 0 auto;
            padding: 0 20px 20px 20px; /* —à–∞–ø–∫–∞ –ø—Ä–∏–º—ã–∫–∞–µ—Ç –∫ –≤–µ—Ä—Ö—É */
            box-sizing: border-box;
            flex: 1 0 auto; /* —Ä–∞—Å—Ç—è–≥–∏–≤–∞–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç, —á—Ç–æ–±—ã —Ñ—É—Ç–µ—Ä –±—ã–ª –≤–Ω–∏–∑—É */
        }
        
        /* –ú–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞ */
        @media screen and (max-width: 768px) {
            .container {
                padding: 15px;
                width: 100%;
                max-width: none;
            }
            
            body {
                width: 100vw;
                overflow-x: hidden;
            }
            
            html {
                width: 100vw;
                overflow-x: hidden;
            }
        }
        
        .header {
            display: block;
            color: #111827;
            background: #f3f4f6; /* —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä–∞—è —à–∞–ø–∫–∞ */
            border-bottom: 1px solid #e5e7eb;
            border-radius: 0; /* –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∞—è */
            margin: 0 0 20px 0; /* –ø—Ä–∏–º—ã–∫–∞–µ—Ç –∫ –≤–µ—Ä—Ö–Ω–µ–π –ª–∏–Ω–∏–∏ */
            padding: 10px 0; /* –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω—ã–µ –æ—Ç—Å—Ç—É–ø—ã –≤–Ω—É—Ç—Ä–∏ */
        }
        
        .header h1 {
            margin: 0;
            display: flex;
            align-items: center;
            justify-content: center; /* –ª–æ–≥–æ—Ç–∏–ø –ø–æ —Ü–µ–Ω—Ç—Ä—É */
        }
        
        .logo {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            object-fit: cover;
        }
        
        .logo-link {
            text-decoration: none;
            display: inline-block;
            transition: transform 0.2s ease;
            cursor: pointer;
        }
        
        .logo-link:hover {
            transform: scale(1.05);
        }
        
        .header p { display: none; }
        
        .search-bar {
            background: white;
            border-radius: 20px;
            padding: 10px 16px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.08);
        }
        
        .search-input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 0.95rem;
            background: transparent;
        }
        
        .categories {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .category-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        
        .category-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ */
        .category-header {
            cursor: pointer;
            padding: 10px;
            border-radius: 10px;
            transition: background-color 0.2s ease;
        }
        
        .category-header:hover {
            background-color: rgba(102, 126, 234, 0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –±—Ä–µ–Ω–¥–æ–≤ */
        .brands-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
            padding: 16px;
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #dee2e6 100%);
            border-radius: 16px;
            border: 1px solid #ced4da;
            box-shadow: inset 0 1px 3px rgba(0,0,0,0.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –±—Ä–µ–Ω–¥–æ–≤ */
        .brand-button {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 10px 16px;
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            color: #495057;
            border: 1px solid #dee2e6;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-size: 0.9rem;
            font-weight: 500;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            min-width: 90px;
            justify-content: center;
            position: relative;
            overflow: hidden;
        }
        
        .brand-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
            transition: left 0.5s;
        }
        
        .brand-button:hover::before {
            left: 100%;
        }
        
        .brand-button:hover {
            background: linear-gradient(135deg, #007bff 0%, #0056b3 100%);
            color: white;
            border-color: #007bff;
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 8px 25px rgba(0,123,255,0.4);
        }
        
        .brand-button:active {
            transform: translateY(-1px) scale(1.02);
            box-shadow: 0 4px 15px rgba(0,123,255,0.3);
        }
        
        .brand-icon {
            font-size: 1.1rem;
            opacity: 0.9;
            transition: transform 0.3s ease;
        }
        
        .brand-button:hover .brand-icon {
            transform: scale(1.1);
        }
        
        .brand-name {
            font-weight: 600;
            letter-spacing: 0.3px;
        }
        
        .brand-count {
            background: rgba(0,123,255,0.1);
            color: #007bff;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: 4px;
            transition: all 0.3s ease;
            border: 1px solid rgba(0,123,255,0.2);
        }
        
        .brand-button:hover .brand-count {
            background: rgba(255,255,255,0.25);
            color: white;
            border-color: rgba(255,255,255,0.3);
            transform: scale(1.1);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π */
        .subcategories {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid rgba(255,255,255,0.2);
        }
        
        .subcategory-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: rgba(255,255,255,0.1);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9em;
        }
        
        .subcategory-item:hover {
            background: rgba(255,255,255,0.2);
            transform: translateX(5px);
        }
        
        .subcategory-icon {
            margin-right: 8px;
            font-size: 1.1em;
        }
        
        .subcategory-name {
            flex: 1;
            font-weight: 500;
        }
        
        /* Tablet: use two larger cards per row */
        @media (max-width: 768px) {
            .categories {
                grid-template-columns: repeat(3, minmax(160px, 1fr)) !important; /* 3 cards per row on tablets */
                gap: 16px !important;
            }
            .category-card { padding: 22px !important; }
        }

        /* Mobile: 2 columns with very compact design */
        @media (max-width: 430px) {
            .categories {
                grid-template-columns: repeat(2, 1fr) !important; /* 2 cards per row on mobile */
                gap: 6px !important;
            }
            .category-card {
                padding: 8px !important;
                border-radius: 8px !important;
            }
            .category-name {
                font-size: 0.8rem !important;
                margin-bottom: 4px !important;
            }
            .category-count {
                font-size: 0.7rem !important;
            }
            .category-icon {
                font-size: 1.2rem !important;
                margin-bottom: 4px !important;
            }
            .brands-container {
                padding: 6px !important;
                gap: 4px !important;
                margin-top: 6px !important;
            }
            .brand-button {
                padding: 4px 6px !important;
                font-size: 0.75rem !important;
            }
            .brand-icon {
                font-size: 0.8rem !important;
            }
            .brand-name {
                font-size: 0.75rem !important;
            }
            .brand-count {
                font-size: 0.65rem !important;
            }
            .subcategory-item { font-size: 0.9rem !important; }
        }
        
        /* Extra small screens - ultra compact 2 columns */
        @media (max-width: 360px) {
            .categories {
                grid-template-columns: repeat(2, 1fr) !important;
                gap: 4px !important;
            }
            .category-card {
                padding: 6px !important;
            }
            .category-name {
                font-size: 0.75rem !important;
                margin-bottom: 2px !important;
            }
            .category-count {
                font-size: 0.65rem !important;
            }
            .category-icon {
                font-size: 1rem !important;
                margin-bottom: 2px !important;
            }
            .brands-container {
                padding: 4px !important;
                gap: 2px !important;
                margin-top: 4px !important;
            }
            .brand-button {
                padding: 3px 4px !important;
                font-size: 0.7rem !important;
            }
            .brand-icon {
                font-size: 0.7rem !important;
            }
            .brand-name {
                font-size: 0.7rem !important;
            }
            .brand-count {
                font-size: 0.6rem !important;
            }
        }

        .subcategory-count {
            font-size: 0.8em;
            opacity: 0.8;
            background: rgba(255,255,255,0.2);
            padding: 2px 6px;
            border-radius: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫ */
        .breadcrumbs {
            margin: 8px 0 12px 0;
            padding: 6px 12px;
            background: white;
            border-radius: 4px;
            border: 1px solid #e9ecef;
            box-shadow: 0 1px 4px rgba(0,0,0,0.03);
        }
        
        .breadcrumb-trail {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 4px;
            font-size: 11px;
            color: #6c757d;
            opacity: 0.8;
        }
        
        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 4px;
        }
        
        .breadcrumb-link {
            color: #667eea;
            text-decoration: none;
            padding: 2px 4px;
            border-radius: 2px;
            transition: all 0.2s ease;
            font-size: 11px;
        }
        
        .breadcrumb-link:hover {
            background: #667eea;
            color: white;
            opacity: 1;
        }
        
        .breadcrumb-current {
            color: #495057;
            font-weight: 400;
            padding: 2px 4px;
            background: transparent;
            border-radius: 2px;
            font-size: 11px;
        }
        
        .breadcrumb-separator {
            color: #adb5bd;
            margin: 0 2px;
            font-size: 10px;
            opacity: 0.6;
        }
        
        .category-header {
            text-align: center;
            margin-bottom: 2rem;
            padding: 1rem;
            background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
            border-radius: 15px;
            color: #333;
        }
        
        .category-header h2 {
            margin: 0;
            font-size: 1.8rem;
            font-weight: 600;
        }
        
        .category-header p {
            margin: 8px 0 0 0;
            opacity: 0.9;
            font-size: 1rem;
        }
        
        .subcategories-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            padding: 1rem 0;
        }
        
        .subcategory-card {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 2px solid transparent;
        }
        
        .subcategory-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            border-color: #667eea;
        }
        
        .subcategory-card .subcategory-icon {
            font-size: 2.5rem;
            margin-bottom: 1rem;
            display: block;
        }
        
        .subcategory-card .subcategory-name {
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }
        
        .subcategory-card .subcategory-count {
            font-size: 0.9rem;
            color: #666;
            background: #f8f9fa;
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            display: inline-block;
        }
        
        .product-description-spoiler, .product-specifications-spoiler {
            margin: 10px 0;
        }
        
        .spoiler-header {
            cursor: pointer;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background-color 0.2s ease;
        }
        
        .spoiler-header:hover {
            background-color: #f8f9fa;
            border-radius: 5px;
            padding: 8px 10px;
            margin: 0 -10px;
        }
        
        .spoiler-title {
            font-weight: 600;
            color: #333;
            font-size: 0.8rem;
        }
        
        .spoiler-arrow {
            color: #667eea;
            font-size: 0.7rem;
            transition: transform 0.2s ease;
        }
        
        .spoiler-content {
            padding: 10px 0;
            margin-top: 5px;
        }
        
        .product-description {
            font-size: 0.9rem;
            color: #666;
            line-height: 1.4;
        }
        
        .specifications {
            font-size: 0.8rem;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            padding: 3px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .spec-key {
            font-weight: 600;
            color: #333;
            font-size: 0.8rem;
        }
        
        .spec-value {
            color: #666;
            text-align: right;
            max-width: 60%;
            font-size: 0.8rem;
        }
        
        .product-variants {
            margin: 12px 0;
            padding: 12px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .variant-group {
            margin-bottom: 8px;
        }
        
        .variant-group:last-child {
            margin-bottom: 0;
        }
        
        .variant-group label {
            display: block;
            font-weight: 600;
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        .variant-buttons {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }
        
        .variant-btn {
            padding: 5px 10px;
            border: 1px solid #ddd;
            background: white;
            border-radius: 18px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
            min-width: 50px;
            text-align: center;
        }
        
        .variant-btn:hover {
            border-color: #667eea;
            background: #f0f3ff;
        }
        
        .variant-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            font-weight: 600;
        }
        
        .variant-btn.active:hover {
            background: #5a67d8;
            border-color: #5a67d8;
        }
        
        /* Special styles for color buttons */
        .color-btn {
            position: relative;
            overflow: hidden;
            border: 2px solid;
            font-weight: 600;
            text-shadow: 0px 0px 2px rgba(0,0,0,0.3);
            min-width: 40px;
            padding: 8px 10px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            border-radius: 12px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            cursor: pointer;
            backdrop-filter: blur(10px);
        }
        
        .color-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(255,255,255,0.2) 0%, rgba(255,255,255,0.05) 50%, rgba(0,0,0,0.1) 100%);
            pointer-events: none;
            border-radius: 10px;
            transition: opacity 0.3s ease;
        }
        
        .color-btn:hover::before {
            opacity: 0.8;
        }
        
        .color-btn.active::before {
            opacity: 1;
            background: linear-gradient(135deg, rgba(255,255,255,0.3) 0%, rgba(255,255,255,0.1) 50%, rgba(0,0,0,0.05) 100%);
        }
        
        .color-btn:hover {
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 8px 16px rgba(0,0,0,0.4);
            filter: brightness(1.1) saturate(1.2);
            border-color: rgba(255,255,255,0.3);
        }
        
        .color-btn.active {
            transform: scale(1.08);
            box-shadow: 0 8px 20px rgba(0,0,0,0.5);
            filter: brightness(1.2) saturate(1.3);
            border-color: rgba(255,255,255,0.5);
        }
        
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –≥—Ä—É–ø–ø –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ */
        .variant-group {
            margin: 15px 0;
        }
        
        .variant-group label {
            display: block;
            font-weight: 600;
            color: #555;
            font-size: 0.8rem;
            margin-bottom: 8px;
            opacity: 0.8;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –ø–∞–º—è—Ç–∏ –∏ SIM */
        .memory-btn, .sim-btn {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            color: #495057;
        }
        
        .memory-btn:hover, .sim-btn:hover {
            background: #667eea;
            color: white;
            border-color: #667eea;
        }
        
        .memory-btn.active, .sim-btn.active {
            background: #667eea;
            color: white;
            border-color: #667eea;
            font-weight: 600;
        }
        /* Help (About) floating button */
        .help-fab {
            position: fixed;
            top: 18px;
            right: 18px;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: #2d6cdf;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 18px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 1100;
        }
        .help-fab:hover { background: #1f56bf; }
        .about-backdrop {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1099;
        }
        .about-modal { background: #fff; width: min(720px, 92vw); max-height: 86vh; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
        .about-header { display: flex; align-items: center; justify-content: space-between; padding: 14px 18px; border-bottom: 1px solid #eee; }
        .about-title { font-size: 18px; font-weight: 700; }
        .about-close { background: transparent; border: none; font-size: 20px; cursor: pointer; color: #666; }
        .about-content { padding: 16px 18px 20px 18px; overflow: auto; max-height: 70vh; }
        .about-section { margin-bottom: 16px; }
        .about-section h4 { margin: 0 0 8px 0; font-size: 15px; }
        .about-list { margin: 0; padding-left: 18px; color: #444; }
        .about-kv { color: #444; }
        .about-kv div { margin: 4px 0; }

        /* About footer at bottom */
        .about-footer {
            margin-top: 30px;
            background: #f3f4f6;
            border-top: 1px solid #e5e7eb;
            padding: 20px;
            border-radius: 12px;
        }
        .about-footer h3 { margin: 0 0 12px 0; font-size: 16px; }
        .about-footer .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 16px;
        }
        
        .category-icon {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .category-name {
            font-weight: 600;
            color: #333;
            margin-bottom: 5px;
        }
        
        .category-count {
            font-size: 0.9rem;
            color: #666;
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–µ—Ä–∞—Ä—Ö–∏—á–µ—Å–∫–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤ */
        .hierarchy-filters {
            margin: 12px 0 8px 0;
            padding: 10px 16px;
            background: #f8f9fa;
            border-radius: 12px;
            border: 1px solid #e9ecef;
        }
        
        .hierarchy-filter-section {
            margin-bottom: 0;
        }
        
        .filter-group {
            margin-bottom: 8px;
        }
        
        .filter-group h4 {
            margin: 0 0 6px 0;
            font-size: 13px;
            font-weight: 600;
            color: #495057;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        
        .filter-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        
        .filter-btn {
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #dee2e6;
            border-radius: 16px;
            font-size: 13px;
            font-weight: 400;
            color: #495057;
            cursor: pointer;
            transition: all 0.3s ease;
            white-space: nowrap;
        }
        
        .filter-btn:hover {
            background: #007bff;
            border-color: #007bff;
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,123,255,0.3);
        }
        
        .filter-btn.active {
            background: #007bff;
            border-color: #007bff;
            color: white;
            box-shadow: 0 2px 8px rgba(0,123,255,0.4);
        }
        
        .filter-reset {
            margin-top: 15px;
            padding-top: 15px;
            border-top: 1px solid #dee2e6;
        }
        
        .reset-btn {
            padding: 6px 12px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .reset-btn:hover {
            background: #c82333;
            transform: translateY(-1px);
            box-shadow: 0 2px 6px rgba(220,53,69,0.2);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ */
        .loading-products {
            text-align: center;
            padding: 40px 20px;
            color: #007bff;
            font-size: 16px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 2px dashed #dee2e6;
            animation: pulse 1.5s ease-in-out infinite alternate;
        }
        
        @keyframes pulse {
            from { opacity: 0.6; }
            to { opacity: 1; }
        }
        
        .product-card {
            background: white;
            border-radius: 15px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        
        .product-image {
            width: 100%;
            height: 300px;
            background: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 3rem;
            color: #999;
        }
        
        .product-info {
            padding: 20px;
        }
        
        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 8px;
            color: #333;
        }
        
        .product-brand {
            color: #666;
            font-size: 0.9rem;
            margin-bottom: 10px;
        }
        
        .product-price {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .current-price {
            font-size: 1.4rem;
            font-weight: 400;
            color: #000;
        }
        
        .old-price {
            font-size: 1rem;
            color: #999;
            text-decoration: line-through;
        }
        
        .discount {
            background: #e74c3c;
            color: #333;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: 600;
        }
        
        .product-description {
            color: #666;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        
        .loading {
            text-align: center;
            padding: 40px;
            color: #333;
            font-size: 1.2rem;
        }
        
        .error {
            text-align: center;
            padding: 40px;
            color: #333;
            background: rgba(231, 76, 60, 0.1);
            border-radius: 15px;
            margin: 20px 0;
        }
        
        .no-products {
            text-align: center;
            padding: 40px;
            color: #333;
            font-size: 1.1rem;
        }
        
        .back-button {
            background: white;
            border: none;
            border-radius: 20px;
            padding: 6px 12px;
            margin-bottom: 12px;
            cursor: pointer;
            font-weight: 400;
            font-size: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–∞—Ä—É—Å–µ–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .product-image-carousel {
            position: relative;
            width: 100%;
            height: 300px;
            overflow: hidden;
            border-radius: 15px;
            padding: 5%;
            box-sizing: border-box;
            background: white;
        }
        
        .product-img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            border-radius: 15px;
            margin: 5%;
            transition: opacity 0.2s ease-in-out;
        }
        
        .image-placeholder {
            width: 90%;
            height: 90%;
            margin: 5%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1rem;
            background: #f0f0f0;
            border-radius: 15px;
        }
        
        .loading-placeholder {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 30px;
            height: 30px;
            margin: 0;
            background: transparent;
            animation: spin 1.5s linear infinite;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .loading-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
        }
        
        @keyframes spin {
            0% { transform: translate(-50%, -50%) rotate(0deg); }
            100% { transform: translate(-50%, -50%) rotate(360deg); }
        }
        
        .image-indicators {
            position: absolute;
            bottom: 10px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 8px;
        }
        
        .indicator {
            width: 6px;
            height: 6px;
            border-radius: 50%;
            background: rgba(150, 150, 150, 0.6);
            cursor: default;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(200, 200, 200, 0.3);
            pointer-events: none;
        }
        
        .indicator.active {
            width: 10px;
            height: 10px;
            background: rgba(60, 60, 60, 0.9);
            border: 1px solid rgba(40, 40, 40, 0.5);
            transform: scale(1.2);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }
        
        .image-nav {
            position: absolute;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            color: #666;
            width: auto;
            height: auto;
            border-radius: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 32px;
            padding: 15px 12px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.3s ease;
            border: none;
            outline: none;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            z-index: 10;
        }
        
        .product-image-carousel:hover .image-nav {
            opacity: 1;
        }
        
        .image-nav.prev {
            left: 10px;
        }
        
        .image-nav.next {
            right: 10px;
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –∞–Ω–∏–º–∞—Ü–∏–∏ —Å–ª–∞–π–¥–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π */
        .product-image-carousel {
            position: relative;
        }
        
        .image-slide-container {
            position: relative;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }
        
        .image-slide-wrapper {
            display: flex;
            width: 100%;
            height: 100%;
            transition: transform 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .image-slide-item {
            flex: 0 0 100%;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .image-slide-item img {
            width: 90%;
            height: 90%;
            object-fit: contain;
            border-radius: 10px;
            transition: opacity 0.3s ease-in-out;
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –ø–æ—è–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .image-slide-item.fade-in {
            animation: fadeInSlide 0.4s ease-in-out;
        }
        
        @keyframes fadeInSlide {
            0% {
                opacity: 0;
                transform: translateX(20px);
            }
            100% {
                opacity: 1;
                transform: translateX(0);
            }
        }
        
        /* –ê–Ω–∏–º–∞—Ü–∏—è –∏—Å—á–µ–∑–Ω–æ–≤–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è */
        .image-slide-item.fade-out {
            animation: fadeOutSlide 0.3s ease-in-out;
        }
        
        @keyframes fadeOutSlide {
            0% {
                opacity: 1;
                transform: translateX(0);
            }
            100% {
                opacity: 0;
                transform: translateX(-20px);
            }
        }
        
        /* –°—Ç–∏–ª–∏ –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–∞ */
        .product-details {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .product-details-header {
            display: flex;
            gap: 30px;
            margin-bottom: 30px;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .product-details-image {
            flex: 0 0 300px;
        }
        
        .details-img {
            width: 100%;
            height: 300px;
            object-fit: cover;
            border-radius: 15px;
        }
        
        .details-placeholder {
            width: 100%;
            height: 300px;
            background: #f5f5f5;
            border-radius: 15px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 60px;
        }
        
        .product-details-info {
            flex: 1;
        }
        
        .product-details-name {
            font-size: 2.5em;
            font-weight: bold;
            color: #333;
            margin: 0 0 10px 0;
        }
        
        .product-details-brand {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 20px;
        }
        
        .product-details-price {
            margin-bottom: 15px;
        }
        
        .product-details-sku {
            font-size: 0.9em;
            color: #888;
            font-family: monospace;
        }
        
        .product-details-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .product-description-section,
        .product-specifications-section {
            margin-bottom: 30px;
        }
        
        .product-description-section h3,
        .product-specifications-section h3 {
            font-size: 1.2em;
            color: #333;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007AFF;
        }
        
        .product-full-description {
            line-height: 1.6;
            color: #555;
            font-size: 1.1em;
        }
        
        .specifications-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .spec-category {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #007AFF;
        }
        
        .spec-category h4 {
            margin: 0 0 15px 0;
            color: #333;
            font-size: 1.2em;
            text-transform: capitalize;
        }
        
        .spec-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            padding: 5px 0;
        }
        
        .spec-key {
            font-weight: 600;
            color: #555;
            flex: 0 0 40%;
        }
        
        .spec-value {
            color: #333;
            flex: 1;
            text-align: right;
        }
        
        .product-actions {
            display: flex;
            gap: 15px;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #eee;
        }
        
        .buy-button,
        .favorite-button {
            padding: 15px 30px;
            border: none;
            border-radius: 10px;
            font-size: 1.1em;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .buy-button {
            background: #007AFF;
            color: #333;
            flex: 1;
        }
        
        .buy-button:hover {
            background: #0056CC;
            transform: translateY(-2px);
        }
        
        .favorite-button {
            background: #f8f9fa;
            color: #333;
            border: 2px solid #ddd;
        }
        
        .favorite-button:hover {
            background: #e9ecef;
            border-color: #007AFF;
        }
        
        @media (max-width: 768px) {
            .product-details-header {
                flex-direction: column;
            }
            
            .product-details-image {
                flex: none;
            }
            
            .product-details-name {
                font-size: 2em;
            }
            
            .specifications-grid {
                grid-template-columns: 1fr;
            }
            
            .product-actions {
                flex-direction: column;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .logo {
                width: 40px;
                height: 40px;
            }
            
            .categories {
                grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .product-image {
                height: 250px;
            }
            
            .product-image-carousel {
                height: 250px;
            }
            
            .product-img {
                width: 92%;
                height: 92%;
                margin: 4%;
            }
            
            /* –£–ª—É—á—à–µ–Ω–∏—è –¥–ª—è —Å–≤–∞–π–ø–∞ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞—Ö */
            .product-image-carousel {
                touch-action: pan-x;
                -webkit-overflow-scrolling: touch;
            }
            
            .image-nav {
                display: none !important; /* –°–∫—Ä—ã–≤–∞–µ–º —Å—Ç—Ä–µ–ª–∫–∏ –Ω–∞ –º–æ–±–∏–ª—å–Ω—ã—Ö */
            }
        }
        
        @media (max-width: 480px) {
            .product-image {
                height: 220px;
            }
            
            .product-image-carousel {
                height: 220px;
            }
            
            .product-img {
                width: 94%;
                height: 94%;
                margin: 3%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>
                <a href="#" onclick="goToHomePage()" class="logo-link">
                    <img src="/static/images/logo.jpg" alt="Yo Store" class="logo">
                </a>
            </h1>
        </div>
        
        <div class="search-bar">
            <input type="text" class="search-input" placeholder="üîç –ü–æ–∏—Å–∫ —Ç–æ–≤–∞—Ä–æ–≤..." id="searchInput">
        </div>
        
        <div id="content">
            <div class="loading">–ü–æ–¥–æ–∂–¥–∏—Ç–µ, –∏–¥–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∞...</div>
        </div>
    </div>

    <!-- About footer (bottom block) -->
    <footer class="about-footer">
        <h3>–û –Ω–∞—Å</h3>
        <div class="grid">
            <div>
                <h4>–ö–æ–Ω—Ç–∞–∫—Ç—ã</h4>
                <div class="about-kv">
                    <div>–¢–µ–ª–µ—Ñ–æ–Ω: +7 (999) 123-45-67</div>
                    <div>Email: hello@yo-store.example</div>
                    <div>Telegram: @yostore_support</div>
                </div>
            </div>
            <div>
                <h4>–ê–¥—Ä–µ—Å</h4>
                <div class="about-kv">
                    <div>–≥. –ú–æ—Å–∫–≤–∞, —É–ª. –ü—Ä–∏–º–µ—Ä–Ω–∞—è, 10, –æ—Ñ–∏—Å 5</div>
                    <div>–ü–Ω‚Äì–í—Å: 10:00‚Äì20:00</div>
                </div>
            </div>
            <div>
                <h4>–û –∫–æ–º–ø–∞–Ω–∏–∏</h4>
                <ul class="about-list">
                    <li>–†–∞–±–æ—Ç–∞–µ–º –±—ã—Å—Ç—Ä–æ –∏ –∞–∫–∫—É—Ä–∞—Ç–Ω–æ —Å 2018 –≥–æ–¥–∞</li>
                    <li>–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø–æ—Å—Ç–∞–≤–∫–∏ –∏ –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –ø–æ—Å—Ç–∞–≤—â–∏–∫–∏</li>
                    <li>–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –≥–∞—Ä–∞–Ω—Ç–∏—è –∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞</li>
                    <li>–£–¥–æ–±–Ω—ã–µ —Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã –∏ –¥–æ—Å—Ç–∞–≤–∫–∏</li>
                </ul>
            </div>
        </div>
    </footer>

    <script>
        const API_BASE = window.location.origin;
        let currentView = 'categories';
        
        // –ì–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
        let currentBrandFilter = null;
        let currentLevel0Filter = null;
        let currentLevel1Filter = null;
        let currentLevel2Filter = null;
        let currentCategoryId = null; // –°–æ—Ö—Ä–∞–Ω—è–µ–º ID —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        let currentCategoryName = null; // –°–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        
        // –û–±—ä–µ–∫—Ç –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è —Ç–µ–∫—É—â–∏—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        let currentFilters = {
            level0: null,
            level1: null,
            level2: null,
            brand: null
        };
        
        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∏ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è
        function saveAppState() {
            const state = {
                currentCategoryId: currentCategoryId,
                currentCategoryName: currentCategoryName,
                currentBrandFilter: currentBrandFilter,
                currentLevel0Filter: currentLevel0Filter,
                currentLevel1Filter: currentLevel1Filter,
                currentLevel2Filter: currentLevel2Filter,
                currentProductId: currentProductId,
                searchQuery: document.getElementById('searchInput')?.value || '',
                timestamp: Date.now()
            };
            localStorage.setItem('yo_mini_app_state', JSON.stringify(state));
            console.log('üíæ –°–æ—Å—Ç–æ—è–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ:', state);
        }
        
        function restoreAppState() {
            try {
                const savedState = localStorage.getItem('yo_mini_app_state');
                if (!savedState) return false;
                
                const state = JSON.parse(savedState);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–µ —Å–ª–∏—à–∫–æ–º —Å—Ç–∞—Ä–æ–µ (24 —á–∞—Å–∞)
                if (Date.now() - state.timestamp > 24 * 60 * 60 * 1000) {
                    localStorage.removeItem('yo_mini_app_state');
                    return false;
                }
                
                // –í–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                currentCategoryId = state.currentCategoryId;
                currentCategoryName = state.currentCategoryName;
                currentBrandFilter = state.currentBrandFilter;
                currentLevel0Filter = state.currentLevel0Filter;
                currentLevel1Filter = state.currentLevel1Filter;
                currentLevel2Filter = state.currentLevel2Filter;
                currentProductId = state.currentProductId;
                
                console.log('üîÑ –°–æ—Å—Ç–æ—è–Ω–∏–µ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–æ:', state);
                return true;
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏—è:', error);
                localStorage.removeItem('yo_mini_app_state');
                return false;
            }
        }
        
        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, starting initialization...');
            
            // –¢–µ—Å—Ç —á—Ç–æ JavaScript —Ä–∞–±–æ—Ç–∞–µ—Ç
            setTimeout(() => {
                console.log('JavaScript is working - DOM fully loaded');
                const content = document.getElementById('content');
                if (content) {
                    console.log('Content element found:', content);
                } else {
                    console.error('Content element not found!');
                }
            }, 1000);
            
            try {
                // –ü—ã—Ç–∞–µ–º—Å—è –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                const stateRestored = restoreAppState();
                
                if (stateRestored && currentProductId) {
                    // –ï—Å–ª–∏ –±—ã–ª –æ—Ç–∫—Ä—ã—Ç —Ç–æ–≤–∞—Ä, –∑–∞–≥—Ä—É–∂–∞–µ–º –µ–≥–æ
                    showProductDetails(currentProductId);
                } else if (stateRestored && currentBrandFilter) {
                    // –ï—Å–ª–∏ –±—ã–ª –≤—ã–±—Ä–∞–Ω –±—Ä–µ–Ω–¥, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –±—Ä–µ–Ω–¥–∞
                    loadProductsByBrand(currentBrandFilter, currentLevel0Filter);
                } else if (stateRestored && currentCategoryId) {
                    // –ï—Å–ª–∏ –±—ã–ª–∞ –≤—ã–±—Ä–∞–Ω–∞ –∫–∞—Ç–µ–≥–æ—Ä–∏—è, –∑–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    loadProducts(currentCategoryId);
                } else {
                    // –ò–Ω–∞—á–µ –∑–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (–≥–ª–∞–≤–Ω–∞—è —Å—Ç—Ä–∞–Ω–∏—Ü–∞)
                    loadCategories();
                }
                
                setupSearch();
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤
                initializeSwipeSupport();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –∑–∞–∫—Ä—ã—Ç–∏–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                window.addEventListener('beforeunload', saveAppState);
                
                // –¢–∞–π–º–∞—É—Ç –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞—Å—Ç—Ä—è–ª–∞
                setTimeout(() => {
                    const content = document.getElementById('content');
                    if (content.textContent.includes('–∑–∞–≥—Ä—É–∑–∫–∞')) {
                        console.error('Loading timeout - forcing reload');
                        showError('–í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–µ–∫–ª–æ. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –æ–±–Ω–æ–≤–∏—Ç—å —Å—Ç—Ä–∞–Ω–∏—Ü—É.');
                    }
                }, 10000); // 10 —Å–µ–∫—É–Ω–¥
                
            } catch (error) {
                console.error('Initialization error:', error);
                showError('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: ' + error.message);
            }
        });
        
        // Setup search functionality
        function setupSearch() {
            const searchInput = document.getElementById('searchInput');
            let searchTimeout;
            
            searchInput.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => {
                    const query = this.value.trim();
                    if (query.length > 2) {
                        searchProducts(query);
                    } else if (query.length === 0 && currentView === 'search') {
                        loadCategories();
                    }
                }, 500);
            });
        }
        
        // Clear filters function
        function clearFilters() {
            // Clear hierarchy filters
            const hierarchyFilters = document.getElementById('hierarchyFilters');
            if (hierarchyFilters) {
                hierarchyFilters.style.display = 'none';
            }
            
            // Clear active filter buttons
            const activeButtons = document.querySelectorAll('.filter-btn.active');
            activeButtons.forEach(btn => btn.classList.remove('active'));
            
            // Reset current filters
            currentFilters = {
                level0: null,
                level1: null,
                level2: null,
                brand: null
            };
        }
        
        // Go to home page function
        function goToHomePage() {
            console.log('üè† Going to home page...');
            
            // Clear search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.value = '';
            }
            
            // Hide products section
            const productsSection = document.getElementById('products');
            if (productsSection) {
                productsSection.style.display = 'none';
            }
            
            // Show categories section
            const categoriesSection = document.getElementById('categories');
            if (categoriesSection) {
                categoriesSection.style.display = 'block';
            }
            
            // Clear any active filters
            clearFilters();
            
            // Reset current view
            currentView = 'categories';
            
            // Reload categories to show fresh data
            loadCategories();
            
            // Scroll to top
            window.scrollTo({ top: 0, behavior: 'smooth' });
            
            console.log('‚úÖ Home page loaded');
        }
        
        // Load categories with brands inside
        async function loadCategories() {
            try {
                console.log('Starting loadCategories...');
                showLoading();
                
                // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –≤—Å–µ —Ñ–∏–ª—å—Ç—Ä—ã –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                currentCategoryId = null;
                currentCategoryName = null;
                currentBrandFilter = null;
                currentLevel0Filter = null;
                currentLevel1Filter = null;
                currentLevel2Filter = null;
                currentProductId = null;
                saveAppState();
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const categoriesResponse = await fetch(`${API_BASE}/categories`);
                if (!categoriesResponse.ok) {
                    throw new Error(`HTTP ${categoriesResponse.status}: ${categoriesResponse.statusText}`);
                }
                const categories = await categoriesResponse.json();
                
                // –ü–æ–ª—É—á–∞–µ–º –≤—Å–µ –±—Ä–µ–Ω–¥—ã
                const brandsResponse = await fetch(`${API_BASE}/hierarchy/brands`);
                const allBrands = await brandsResponse.json();
                
                currentView = 'categories';
                
                const content = document.getElementById('content');
                let categoriesHtml = '<div class="categories">';
                
                for (const category of categories) {
                    console.log(`Processing category: ${category.name}`);
                    
                    // –ü–æ–ª—É—á–∞–µ–º –±—Ä–µ–Ω–¥—ã –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    const brandData = [];
                    for (const brand of allBrands) {
                        try {
                            const countResponse = await fetch(`${API_BASE}/products?brand=${encodeURIComponent(brand)}&level0=${encodeURIComponent(category.level_0)}&limit=1`);
                            const products = await countResponse.json();
                            if (products && products.length > 0) {
                                // –ü–æ–ª—É—á–∞–µ–º —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                                const fullCountResponse = await fetch(`${API_BASE}/products?brand=${encodeURIComponent(brand)}&level0=${encodeURIComponent(category.level_0)}&limit=1000`);
                                const allProducts = await fullCountResponse.json();
                                
                                brandData.push({
                                    brand: brand,
                                    icon: brand === 'Apple' ? 'üçé' : (brand === 'Samsung' ? 'üì±' : 'üì¶'),
                                    product_count: allProducts.length
                                });
                            }
                        } catch (error) {
                            console.warn(`–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–æ–≤ –¥–ª—è –±—Ä–µ–Ω–¥–∞ ${brand}:`, error);
                        }
                    }
                    
                    categoriesHtml += `
                        <div class="category-card">
                            <div class="category-header" onclick="loadSubcategories(${category.id})">
                                <div class="category-icon">${category.icon}</div>
                                <div class="category-name">${category.name}</div>
                                <div class="category-count">${category.product_count} —Ç–æ–≤–∞—Ä–æ–≤</div>
                            </div>
                    `;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –±—Ä–µ–Ω–¥—ã –∫–∞–∫ –∫–Ω–æ–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                    if (brandData.length > 0) {
                        categoriesHtml += '<div class="brands-container">';
                        for (const brand of brandData) {
                            categoriesHtml += `
                                <div class="brand-button" onclick="event.stopPropagation(); loadProductsByBrand('${brand.brand}', '${category.level_0}')">
                                    <span class="brand-icon">${brand.icon}</span>
                                    <span class="brand-name">${brand.brand}</span>
                                    <span class="brand-count">${brand.product_count}</span>
                                </div>
                            `;
                        }
                        categoriesHtml += '</div>';
                    }
                    categoriesHtml += '</div>';
                }
                categoriesHtml += '</div>';
                
                content.innerHTML = categoriesHtml;
                console.log('Categories HTML generated and displayed');
                
                // –î–æ–±–∞–≤–∏—Ç—å –Ω–µ–±–æ–ª—å—à—É—é –∑–∞–¥–µ—Ä–∂–∫—É –¥–ª—è –≤–∏–∑—É–∞–ª—å–Ω–æ–≥–æ —ç—Ñ—Ñ–µ–∫—Ç–∞
                setTimeout(() => {
                    console.log('Categories initialization complete');
                }, 100);
                
            } catch (error) {
                console.error('Error loading categories:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–π: ' + error.message);
            }
        }
        
        // Load subcategories for category
        async function loadSubcategories(categoryId) {
            try {
                showLoading();
                
                // –ü–æ–ª—É—á–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é
                const categoriesResponse = await fetch(`${API_BASE}/categories`);
                const categories = await categoriesResponse.json();
                const category = categories.find(cat => cat.id === categoryId);
                
                if (!category) {
                    showError('–ö–∞—Ç–µ–≥–æ—Ä–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω–∞');
                    return;
                }
                
                // –ü–æ–ª—É—á–∞–µ–º –±—Ä–µ–Ω–¥—ã –¥–ª—è —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (level_0)
                const brandsResponse = await fetch(`${API_BASE}/hierarchy/brands`);
                const allBrands = await brandsResponse.json();
                
                // –î–ª—è –∫–∞–∂–¥–æ–≥–æ –±—Ä–µ–Ω–¥–∞ –ø–æ–ª—É—á–∞–µ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –≤ —ç—Ç–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                const brandData = [];
                for (const brand of allBrands) {
                    try {
                        const countResponse = await fetch(`${API_BASE}/products?brand=${encodeURIComponent(brand)}&level_0=${encodeURIComponent(category.level_0)}&limit=1`);
                        const products = await countResponse.json();
                        if (products && products.length > 0) {
                            // –ü–æ–ª—É—á–∞–µ–º —Ç–æ—á–Ω–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
                            const fullCountResponse = await fetch(`${API_BASE}/products?brand=${encodeURIComponent(brand)}&level_0=${encodeURIComponent(category.level_0)}&limit=1000`);
                            const allProducts = await fullCountResponse.json();
                            
                            brandData.push({
                                brand: brand,
                                icon: brand === 'Apple' ? 'üçé' : (brand === 'Samsung' ? 'üì±' : 'üì¶'),
                                product_count: allProducts.length
                            });
                        }
                    } catch (e) {
                        console.error(`Error checking brand ${brand}:`, e);
                    }
                }
                
                if (brandData.length === 0) {
                    showError('–ë—Ä–µ–Ω–¥—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã');
                    return;
                }
                
                currentView = 'subcategories';
                currentCategoryId = categoryId;
                
                const content = document.getElementById('content');
                content.innerHTML = `
                    <button class="back-button" onclick="loadCategories()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                    <div class="category-header">
                        <h2>${category.icon} ${category.name}</h2>
                        <p>–í—ã–±–µ—Ä–∏—Ç–µ –±—Ä–µ–Ω–¥ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ —Ç–æ–≤–∞—Ä–æ–≤</p>
                    </div>
                    <div class="subcategories-grid">
                        ${brandData.map(subcat => `
                            <div class="subcategory-card" onclick="loadProductsByBrandWithCategory('${subcat.brand}', ${categoryId}, '${category.name}')">
                                <div class="subcategory-icon">${subcat.icon}</div>
                                <div class="subcategory-name">${subcat.brand}</div>
                                <div class="subcategory-count">${subcat.product_count} —Ç–æ–≤–∞—Ä–æ–≤</div>
                            </div>
                        `).join('')}
                    </div>
                `;
            } catch (error) {
                console.error('Error loading subcategories:', error);
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–π');
            }
        }
        
        // Load products for category (all products in category and subcategories)
        async function loadProducts(categoryId) {
            try {
                showLoading();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                currentCategoryId = categoryId;
                currentBrandFilter = null;
                currentLevel0Filter = null;
                currentLevel1Filter = null;
                currentLevel2Filter = null;
                currentProductId = null;
                saveAppState();
                
                const response = await fetch(`${API_BASE}/products?category_id=${categoryId}&limit=20`);
                const products = await response.json();
                
                currentView = 'products';
                
                const content = document.getElementById('content');
                content.innerHTML = `
                    <button class="back-button" onclick="loadCategories()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                    <div class="products-grid">
                        ${products.map(product => {
                            storeProductImages(product);
                            return createProductCard(product);
                        }).join('')}
                    </div>
                `;
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                setTimeout(async () => {
                    await initializeDefaultColors();
                    await loadDefaultImages();
                }, 100);
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤');
            }
        }
        
        // Load products by brand with hierarchical filters
        async function loadProductsByBrand(brand, categoryLevel0) {
            try {
                showLoading();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Ç–µ–∫—É—â–∏–π —Ñ–∏–ª—å—Ç—Ä –±—Ä–µ–Ω–¥–∞ –∏ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                currentBrandFilter = brand;
                currentLevel0Filter = categoryLevel0; // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é –∏–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞
                currentLevel1Filter = null;
                currentLevel2Filter = null;
                currentProductId = null; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º —Ç–æ–≤–∞—Ä –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –∫ —Å–ø–∏—Å–∫—É
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
                saveAppState();
                
                // –ü–æ–ª—É—á–∞–µ–º —Ç–æ–≤–∞—Ä—ã —Å —É—á–µ—Ç–æ–º —É—Ä–æ–≤–Ω—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ (level0)
                let url = `${API_BASE}/products?brand=${encodeURIComponent(brand)}&level0=${encodeURIComponent(categoryLevel0)}&limit=50`;
                console.log(`üîó –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º —Ç–æ–≤–∞—Ä—ã –±—Ä–µ–Ω–¥–∞ ${brand} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${categoryLevel0}: ${url}`);
                
                const response = await fetch(url);
                const products = await response.json();
                console.log(`üì¶ –ü–æ–ª—É—á–µ–Ω–æ —Ç–æ–≤–∞—Ä–æ–≤: ${products.length}`);
                if (products.length > 0) {
                    console.log(`üìã –ü–µ—Ä–≤—ã–π —Ç–æ–≤–∞—Ä: ${products[0].name} (level0: ${products[0].level0})`);
                }
                
                currentView = 'brand_products';
                
                const content = document.getElementById('content');
                content.innerHTML = `
                    <button class="back-button" onclick="loadCategories()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                    <div class="breadcrumbs" id="breadcrumbsContainer">
                        ${createBreadcrumbs(brand)}
                    </div>
                    <div class="hierarchy-filters" id="hierarchyFilters">
                        <!-- –§–∏–ª—å—Ç—Ä—ã –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                    <div class="products-grid">
                        ${products.map(product => {
                            storeProductImages(product);
                            return createProductCard(product);
                        }).join('')}
                    </div>
                `;
                
                // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏ level1
                await createHierarchyFilters(brand, products);
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                setTimeout(async () => {
                    await initializeDefaultColors();
                    await loadDefaultImages();
                    await loadAllSpecifications();
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π
                    initializeSwipeSupport();
                }, 100);
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤ –±—Ä–µ–Ω–¥–∞');
            }
        }
        
        // Search products
        async function searchProducts(query) {
            try {
                showLoading();
                const response = await fetch(`${API_BASE}/search?q=${encodeURIComponent(query)}&limit=20`);
                const products = await response.json();
                
                currentView = 'search';
                currentCategoryId = null;
                
                const content = document.getElementById('content');
                if (products.length === 0) {
                    content.innerHTML = `
                        <div class="no-products">
                            –ü–æ –∑–∞–ø—Ä–æ—Å—É "${query}" –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ
                        </div>
                    `;
                } else {
                    content.innerHTML = `
                        <button class="back-button" onclick="loadCategories()">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</button>
                        <div class="products-grid">
                            ${products.map(product => {
                                storeProductImages(product);
                                return createProductCard(product);
                            }).join('')}
                        </div>
                    `;
                    
                    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –ø–æ—Å–ª–µ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞
                    setTimeout(async () => {
                        await initializeDefaultColors();
                        await loadDefaultImages();
                        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤ –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π
                        initializeSwipeSupport();
                    }, 100);
                }
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞');
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ –±—Ä–µ–Ω–¥–∞ —Å —É—á–µ—Ç–æ–º –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        async function loadProductsByBrandWithCategory(brand, categoryId, categoryName) {
            console.log(`üéØ –ó–∞–≥—Ä—É–∂–∞–µ–º —Ç–æ–≤–∞—Ä—ã –±—Ä–µ–Ω–¥–∞ ${brand} –≤ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ ${categoryName}`);
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º level0Filter –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            currentLevel0Filter = categoryName;
            currentCategoryId = categoryId;
            currentCategoryName = categoryName;
            console.log(`üìù –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã —Ñ–∏–ª—å—Ç—Ä—ã: level0=${currentLevel0Filter}, categoryId=${currentCategoryId}`);
            // –í—ã–∑—ã–≤–∞–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ñ—É–Ω–∫—Ü–∏—é
            await loadProductsByBrand(brand, categoryName);
        }
        
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –∏–µ—Ä–∞—Ä—Ö–∏–∏
        async function createHierarchyFilters(brand, products) {
            try {
                console.log(`üèóÔ∏è –°–æ–∑–¥–∞–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –±—Ä–µ–Ω–¥–∞ ${brand}, currentLevel0Filter: ${currentLevel0Filter}`);
                
                const filtersContainer = document.getElementById('hierarchyFilters');
                if (!filtersContainer) return;
                
                // –ï—Å–ª–∏ level0 –µ—â–µ –Ω–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω, –æ–ø—Ä–µ–¥–µ–ª—è–µ–º –µ–≥–æ –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤ (–ø–µ—Ä–≤–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è)
                if (!currentLevel0Filter && products.length > 0) {
                    const firstProductLevel0 = products[0].level0 || products[0].category_name.split(' / ')[0];
                    currentLevel0Filter = firstProductLevel0;
                    console.log(`üîç –ê–≤—Ç–æ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω level0 –∏–∑ —Ç–æ–≤–∞—Ä–æ–≤: ${currentLevel0Filter}`);
                }
                
                let filtersHtml = '<div class="hierarchy-filter-section"><div style="margin: 0 0 10px 0; font-size: 0.9rem; font-weight: normal; color: #666;">–§–∏–ª—å—Ç—Ä—ã</div>';
                
                // Level1 —Ñ–∏–ª—å—Ç—Ä—ã (–Ω–∞—á–∏–Ω–∞–µ–º —Å—Ä–∞–∑—É —Å —É—Ä–æ–≤–Ω—è 1, —Ç–∞–∫ –∫–∞–∫ level0 —É–∂–µ –≤—ã–±—Ä–∞–Ω —Ä–∞–Ω–µ–µ)
                let level1Values = [];
                if (currentLevel0Filter) {
                    const level1Url = `${API_BASE}/hierarchy/levels?level=1&brand=${encodeURIComponent(brand)}&parent_level0=${encodeURIComponent(currentLevel0Filter)}`;
                    console.log(`üîó –ó–∞–ø—Ä–∞—à–∏–≤–∞–µ–º level1 –¥–ª—è ${brand} –≤ ${currentLevel0Filter}: ${level1Url}`);
                    
                    const level1Response = await fetch(level1Url);
                    level1Values = await level1Response.json();
                    console.log(`üìã –ü–æ–ª—É—á–µ–Ω—ã level1 –∑–Ω–∞—á–µ–Ω–∏—è:`, level1Values);
                }
                
                if (level1Values.length > 0) {
                    filtersHtml += `
                        <div class="filter-group">
                            <div class="filter-buttons">
                                ${level1Values.map(level1 => 
                                    `<button class="filter-btn ${currentLevel1Filter === level1 ? 'active' : ''}" 
                                             onclick="applyLevelFilter('level1', '${level1}')">
                                        ${level1}
                                    </button>`
                                ).join('')}
                            </div>
                        </div>
                    `;
                }
                
                // Level2 —Ñ–∏–ª—å—Ç—Ä—ã (–ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω level1)
                if (currentLevel1Filter) {
                    const level2Response = await fetch(`${API_BASE}/hierarchy/levels?level=2&brand=${encodeURIComponent(brand)}&parent_level1=${encodeURIComponent(currentLevel1Filter)}`);
                    const level2Values = await level2Response.json();
                    
                    if (level2Values.length > 0) {
                        filtersHtml += `
                            <div class="filter-group">
                                <div class="filter-buttons">
                                    ${level2Values.map(level2 => 
                                        `<button class="filter-btn ${currentLevel2Filter === level2 ? 'active' : ''}" 
                                                 onclick="applyLevelFilter('level2', '${level2}')">
                                            ${level2}
                                        </button>`
                                    ).join('')}
                                </div>
                            </div>
                        `;
                    }
                }
                
                filtersHtml += '</div>';
                
                // –ö–Ω–æ–ø–∫–∞ —Å–±—Ä–æ—Å–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                if (currentLevel1Filter || currentLevel2Filter) {
                    filtersHtml += `
                        <div class="filter-reset">
                            <button class="reset-btn" onclick="resetFilters()">–°–±—Ä–æ—Å–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                        </div>
                    `;
                }
                
                filtersContainer.innerHTML = filtersHtml;
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤:', error);
            }
        }
        
        // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ –ø–æ —É—Ä–æ–≤–Ω—è–º
        async function applyLevelFilter(filterType, filterValue) {
            try {
                // –û–±–Ω–æ–≤–ª—è–µ–º –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
                if (filterType === 'level0') {
                    currentLevel0Filter = filterValue;
                    currentLevel1Filter = null;
                    currentLevel2Filter = null;
                } else if (filterType === 'level1') {
                    currentLevel1Filter = filterValue;
                    currentLevel2Filter = null;
                } else if (filterType === 'level2') {
                    currentLevel2Filter = filterValue;
                }
                
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã
                await loadFilteredProducts();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
                updateBreadcrumbs();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —Ñ–∏–ª—å—Ç—Ä–æ–≤
                await createHierarchyFilters(currentBrandFilter, []);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–∞:', error);
            }
        }
        
        // –ó–∞–≥—Ä—É–∑–∫–∞ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤
        async function loadFilteredProducts() {
            try {
                // –î–æ–±–∞–≤–∏—Ç—å –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–ª—å–∫–æ –∫ grid —Ç–æ–≤–∞—Ä–æ–≤
                const content = document.getElementById('content');
                const productsContainer = content.querySelector('.products-grid');
                
                if (!productsContainer) {
                    console.error('Products container not found');
                    return;
                }
                
                // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ø–∏–Ω–Ω–µ—Ä –∑–∞–≥—Ä—É–∑–∫–∏
                productsContainer.innerHTML = '<div class="loading-products">–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–æ–≤...</div>';
                
                // –°—Ç—Ä–æ–∏–º URL —Å —Ç–µ–∫—É—â–∏–º–∏ —Ñ–∏–ª—å—Ç—Ä–∞–º–∏
                const params = new URLSearchParams();
                params.append('brand', currentBrandFilter);
                params.append('limit', '50');
                
                if (currentLevel0Filter) params.append('level0', currentLevel0Filter);
                if (currentLevel1Filter) params.append('level1', currentLevel1Filter);
                if (currentLevel2Filter) params.append('level2', currentLevel2Filter);
                
                const response = await fetch(`${API_BASE}/products?${params.toString()}`);
                const products = await response.json();
                
                // –û–±–Ω–æ–≤–ª—è–µ–º —Ç–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä—ã –≤ grid
                productsContainer.innerHTML = products.map(product => {
                    storeProductImages(product);
                    return createProductCard(product);
                }).join('');
                
                // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å —Ü–≤–µ—Ç–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏ –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                setTimeout(async () => {
                    await initializeDefaultColors();
                    await loadDefaultImages();
                }, 100);
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–æ–≤–∞—Ä–æ–≤:', error);
                const productsContainer = document.querySelector('.products-grid');
                if (productsContainer) {
                    productsContainer.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–æ–≤–∞—Ä–æ–≤</div>';
                }
            }
        }
        
        // –°–±—Ä–æ—Å –≤—Å–µ—Ö —Ñ–∏–ª—å—Ç—Ä–æ–≤
        async function resetFilters() {
            currentLevel1Filter = null;
            currentLevel2Filter = null;
            // –ù–ï —Å–±—Ä–∞—Å—ã–≤–∞–µ–º currentLevel0Filter - –æ–Ω –¥–æ–ª–∂–µ–Ω –æ—Å—Ç–∞–≤–∞—Ç—å—Å—è –∏–∑ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
            
            await loadFilteredProducts();
            
            // –û–±–Ω–æ–≤–ª—è–µ–º —Ö–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏
            updateBreadcrumbs();
            
            await createHierarchyFilters(currentBrandFilter, []);
        }
        
        // Create product card HTML
        function createProductCard(product) {
            const discountHtml = product.discount_percentage > 0 
                ? `<span class="discount">-${Math.round(product.discount_percentage)}%</span>` 
                : '';
            
            const oldPriceHtml = product.old_price > product.price 
                ? `<span class="old-price">${Math.round(product.old_price).toLocaleString()} ‚ÇΩ</span>` 
                : '';
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –º–æ–¥–µ–ª—å –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            const modelKey = product.model;
            
            // –°–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—É—é HTML —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ —Ç–æ–≤–∞—Ä–∞
            const variantSelectorsHtml = `
                <div class="product-variants" data-product-id="${product.id}" data-model="${modelKey}">
                    <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤...</div>
                </div>
            `;
            
            // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å—Ä–∞–∑—É
            let imageHtml = '';
            
                if (product.images && product.images.length > 0) {
                // –ï—Å–ª–∏ –µ—Å—Ç—å –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                if (product.images.length > 1) {
                    imageHtml = `
                        <div class="product-image-carousel" data-product-id="${product.id}">
                            <img alt="${product.name}" class="product-img" style="opacity: 0;">
                            <div class="image-placeholder loading-placeholder"><img src="/static/images/logo.jpg" alt="Loading..."></div>
                            <div class="image-indicators">
                                ${product.images.map((_, index) => 
                                    `<span class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`
                                ).join('')}
                            </div>
                            <div class="image-nav prev" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, -1)">‚Äπ</div>
                            <div class="image-nav next" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, 1)">‚Ä∫</div>
                        </div>
                    `;
                } else {
                    // –û–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
                    imageHtml = `
                        <div class="product-image-carousel" data-product-id="${product.id}">
                            <img alt="${product.name}" class="product-img" style="opacity: 0;">
                            <div class="image-placeholder loading-placeholder"><img src="/static/images/logo.jpg" alt="Loading..."></div>
                            <div class="image-indicators"></div>
                            <div class="image-nav prev" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, -1)" style="display:none;">‚Äπ</div>
                            <div class="image-nav next" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, 1)" style="display:none;">‚Ä∫</div>
                        </div>
                    `;
                }
            } else if (product.image_url) {
                // –°—Ç–∞—Ä–æ–µ –ø–æ–ª–µ image_url
                imageHtml = `
                    <div class="product-image-carousel" data-product-id="${product.id}">
                            <img alt="${product.name}" class="product-img" style="opacity: 0;">
                        <div class="image-placeholder loading-placeholder"><img src="/static/images/logo.jpg" alt="Loading..."></div>
                        <div class="image-indicators"></div>
                        <div class="image-nav prev" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, -1)" style="display:none;">‚Äπ</div>
                        <div class="image-nav next" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, 1)" style="display:none;">‚Ä∫</div>
                    </div>
                `;
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º placeholder
                imageHtml = `
                    <div class="product-image-carousel" data-product-id="${product.id}">
                        <div class="image-placeholder loading-placeholder"><img src="/static/images/logo.jpg" alt="Loading..."></div>
                        <div class="image-indicators"></div>
                        <div class="image-nav prev" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, -1)" style="display:none;">‚Äπ</div>
                        <div class="image-nav next" onclick="event.stopPropagation(); changeImageWithSlide(${product.id}, 1)" style="display:none;">‚Ä∫</div>
                    </div>
                `;
            }
            
            return `
                <div class="product-card">
                    <div class="product-image">
                        ${imageHtml}
                    </div>
                    <div class="product-info">
                        <div class="product-name">${product.level_2 || product.name}</div>
                        <div class="product-brand">${product.brand}</div>
                        <div class="product-price">
                            <span class="current-price" id="price-${product.id}">${Math.round(product.price).toLocaleString()} ‚ÇΩ</span>
                            ${oldPriceHtml}
                            ${discountHtml}
                        </div>
                        
                        <!-- –í–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ -->
                        ${variantSelectorsHtml}
                        
                        <!-- –°–ø–æ–π–ª–µ—Ä—ã –¥–ª—è –æ–ø–∏—Å–∞–Ω–∏—è –∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ -->
                        <div class="product-description-spoiler">
                            <div class="spoiler-header" onclick="toggleSpoiler('desc-${product.id}')">
                                <span class="spoiler-title">–û–ø–∏—Å–∞–Ω–∏–µ</span>
                                <span class="spoiler-arrow" id="arrow-desc-${product.id}">‚ñ∂</span>
                            </div>
                            <div class="spoiler-content" id="desc-${product.id}" style="display: none;">
                                <div class="product-description">${product.description}</div>
                            </div>
                        </div>
                        
                        <div class="product-specifications-spoiler">
                            <div class="spoiler-header" onclick="toggleSpoiler('spec-${product.id}')">
                                <span class="spoiler-title">–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</span>
                                <span class="spoiler-arrow" id="arrow-spec-${product.id}">‚ñ∂</span>
                            </div>
                            <div class="spoiler-content" id="spec-${product.id}" style="display: none;">
                                <div class="specifications" data-level2="${product.level_2}">
                                    <div class="loading-specs">–ó–∞–≥—Ä—É–∑–∫–∞ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Toggle spoiler content
        function toggleSpoiler(spoilerId) {
            const content = document.getElementById(spoilerId);
            const arrow = document.getElementById('arrow-' + spoilerId);
            
            if (content.style.display === 'none') {
                content.style.display = 'block';
                arrow.textContent = '‚ñº';
            } else {
                content.style.display = 'none';
                arrow.textContent = '‚ñ∂';
            }
        }
        
        // Calculate variant price
        function calculateVariantPrice(productId, basePrice, selectedVariant) {
            let priceModifier = 0;
            
            // –õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞ —Ü–µ–Ω—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –≤—ã–±—Ä–∞–Ω–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            if (selectedVariant.memory) {
                const memoryPrice = {
                    '128GB': 0,
                    '256GB': 10000,
                    '512GB': 20000,
                    '1TB': 30000
                };
                priceModifier += memoryPrice[selectedVariant.memory] || 0;
            }
            
            if (selectedVariant.color) {
                // –û–±—ã—á–Ω–æ —Ü–≤–µ—Ç –Ω–µ –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–µ–Ω—É, –Ω–æ –º–æ–∂–µ—Ç –±—ã—Ç—å –æ—Å–æ–±—ã–µ —Ü–≤–µ—Ç–∞
                if (selectedVariant.color.includes('Gold') || selectedVariant.color.includes('Special')) {
                    priceModifier += 5000;
                }
            }
            
            if (selectedVariant.sim) {
                if (selectedVariant.sim === 'Dual SIM') {
                    priceModifier += 2000;
                } else if (selectedVariant.sim === 'eSIM') {
                    priceModifier += 1000;
                }
            }
            
            // –î–ª—è –Ω–æ—É—Ç–±—É–∫–æ–≤
            if (selectedVariant.screen) {
                const screenPrice = {
                    '14"': 0,
                    '15"': 15000,
                    '16"': 25000,
                    '17"': 35000
                };
                priceModifier += screenPrice[selectedVariant.screen] || 0;
            }
            
            if (selectedVariant.ram) {
                const ramPrice = {
                    '8GB': 0,
                    '16GB': 10000,
                    '32GB': 25000,
                    '64GB': 50000
                };
                priceModifier += ramPrice[selectedVariant.ram] || 0;
            }
            
            if (selectedVariant.ssd) {
                const ssdPrice = {
                    '256GB': 0,
                    '512GB': 15000,
                    '1TB': 30000,
                    '2TB': 60000
                };
                priceModifier += ssdPrice[selectedVariant.ssd] || 0;
            }
            
            return basePrice + priceModifier;
        }
        
        // Toggle variant button
        function toggleVariant(productId, buttonElement) {
            const productCard = buttonElement.closest('.product-card');
            const variantsContainer = productCard.querySelector('.product-variants');
            const variantType = buttonElement.dataset.type;
            const variantValue = buttonElement.dataset.value || buttonElement.dataset.color;
            
            // –°–Ω—è—Ç—å –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ —Ç–æ–≥–æ –∂–µ —Ç–∏–ø–∞
            const sameTypeButtons = variantsContainer.querySelectorAll(`[data-type="${variantType}"]`);
            sameTypeButtons.forEach(btn => btn.classList.remove('active'));
            
            // –ê–∫—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –≤—ã–±—Ä–∞–Ω–Ω—É—é –∫–Ω–æ–ø–∫—É
            buttonElement.classList.add('active');
            
            // –ü–æ–ª—É—á–∏—Ç—å –≤—Å–µ –≤—ã–±—Ä–∞–Ω–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã
            const selectedVariants = {};
            const activeButtons = variantsContainer.querySelectorAll('.variant-btn.active');
            activeButtons.forEach(btn => {
                selectedVariants[btn.dataset.type] = btn.dataset.value || btn.dataset.color;
            });
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω —Ü–≤–µ—Ç (–ø—Ä–∏ –ª—é–±–æ–º –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤)
            if (variantType === 'color') {
                updateProductImage(productId, variantValue);
            } else {
                // –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥—Ä—É–≥–∏—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ (–ø–∞–º—è—Ç—å, SIM) –æ–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å —Ç–µ–∫—É—â–∏–º —Ü–≤–µ—Ç–æ–º
                const activeColorButton = variantsContainer.querySelector('[data-type="color"].active');
                if (activeColorButton) {
                    const currentColor = activeColorButton.dataset.value || activeColorButton.dataset.color;
                    updateProductImage(productId, currentColor);
                }
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ —Å–º–µ–Ω–µ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            updateProductSpecifications(productId, selectedVariants);
            
            // –ü–æ–ª—É—á–∏—Ç—å –±–∞–∑–æ–≤—É—é —Ü–µ–Ω—É
            const priceElement = productCard.querySelector(`#price-${productId}`);
            const basePriceText = priceElement.textContent.replace(/[^\d]/g, '');
            const basePrice = parseInt(basePriceText) || 0;
            
            // –†–∞—Å—Å—á–∏—Ç–∞—Ç—å –Ω–æ–≤—É—é —Ü–µ–Ω—É
            const newPrice = calculateVariantPrice(productId, basePrice, selectedVariants);
            
            // –û–±–Ω–æ–≤–∏—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ü–µ–Ω—ã
            priceElement.textContent = `${Math.round(newPrice).toLocaleString()} ‚ÇΩ`;
        }
        
        // Update product specifications based on selected variants
        async function updateProductSpecifications(productId, selectedVariants) {
            try {
                // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ —Ç–æ–≤–∞—Ä–µ —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
                const response = await fetch(`/products/${productId}/variants`);
                const variantsData = await response.json();
                
                // –ù–∞–π—Ç–∏ —Ç–æ–≤–∞—Ä —Å –≤—ã–±—Ä–∞–Ω–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
                const matchingVariant = variantsData.variants.find(variant => {
                    return variant.color === selectedVariants.color &&
                           variant.memory === selectedVariants.memory &&
                           variant.sim_type === selectedVariants.sim;
                });
                
                if (matchingVariant) {
                    // –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã level2_descriptions
                    const level2Details = await loadLevel2Details(variantsData.model);
                    
                    // –û–±–Ω–æ–≤–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –≤ DOM
                    const productCard = document.querySelector(`[data-product-id="${productId}"]`)?.closest('.product-card');
                    if (productCard) {
                        const specsElement = productCard.querySelector(`#spec-${productId}`);
                        if (specsElement) {
                            const specsContainer = specsElement.querySelector('.specifications');
                            if (specsContainer) {
                                // –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
                                const allSpecs = {
                                    ...level2Details, // –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ (–ø—Ä–æ—Ü–µ—Å—Å–æ—Ä, —ç–∫—Ä–∞–Ω, –∫–∞–º–µ—Ä–∞ –∏ —Ç.–¥.)
                                    '–ü–∞–º—è—Ç—å': matchingVariant.memory || selectedVariants.memory,
                                    '–¶–≤–µ—Ç': matchingVariant.color || selectedVariants.color,
                                    'SIM': matchingVariant.sim_type || selectedVariants.sim
                                };
                                
                                // –û–±–Ω–æ–≤–∏—Ç—å HTML —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                                specsContainer.innerHTML = Object.entries(allSpecs)
                                    .filter(([key, value]) => value && value !== 'undefined')
                                    .map(([key, value]) => 
                                        `<div class="spec-item"><span class="spec-key">${key}:</span> <span class="spec-value">${value}</span></div>`
                                    ).join('');
                                
                            }
                        }
                    }
                }
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ${productId}:`, error);
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
        async function loadAllSpecifications() {
            const specsContainers = document.querySelectorAll('.specifications[data-level2]');
            
            for (const container of specsContainers) {
                const level2 = container.dataset.level2;
                if (level2) {
                    try {
                        const details = await loadLevel2Details(level2);
                        
                        // –ü–æ–ª—É—á–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –∫ –æ–±—â–∏–º —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∞–º
                        const productCard = container.closest('.product-card');
                        const productIdElement = productCard?.querySelector('[data-product-id]');
                        const productId = productIdElement?.dataset.productId;
                        
                        if (productId) {
                            // –ü–æ–ª—É—á–∏—Ç—å –ø–µ—Ä–≤—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –±–∞–∑–æ–≤—ã—Ö —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                            const response = await fetch(`/products/${productId}/variants`);
                            if (response.ok) {
                                const variantsData = await response.json();
                                const firstVariant = variantsData.variants[0];
                                
                                if (firstVariant) {
                                    // –û–±—ä–µ–¥–∏–Ω–∏—Ç—å –æ–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ —Å –ø–µ—Ä–≤—ã–º –≤–∞—Ä–∏–∞–Ω—Ç–æ–º
                                    const allSpecs = {
                                        ...details, // –û–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                                        '–ü–∞–º—è—Ç—å': firstVariant.memory,
                                        '–¶–≤–µ—Ç': firstVariant.color,
                                        'SIM': firstVariant.sim_type
                                    };
                                    
                                    // –û–±–Ω–æ–≤–∏—Ç—å HTML —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                                    container.innerHTML = Object.entries(allSpecs)
                                        .filter(([key, value]) => value && value !== 'undefined')
                                        .map(([key, value]) => 
                                            `<div class="spec-item"><span class="spec-key">${key}:</span> <span class="spec-value">${value}</span></div>`
                                        ).join('');
                                } else {
                                    // –ï—Å–ª–∏ –Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤, –ø–æ–∫–∞–∑–∞—Ç—å —Ç–æ–ª—å–∫–æ –æ–±—â–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏
                                    container.innerHTML = Object.entries(details)
                                        .filter(([key, value]) => value && value !== 'undefined')
                                        .map(([key, value]) => 
                                            `<div class="spec-item"><span class="spec-key">${key}:</span> <span class="spec-value">${value}</span></div>`
                                        ).join('') || '–•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ –Ω–µ —É–∫–∞–∑–∞–Ω—ã';
                                }
                            }
                        }
                    } catch (error) {
                        console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è ${level2}:`, error);
                        container.innerHTML = '–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫';
                    }
                }
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –∏–∑ —Ç–∞–±–ª–∏—Ü—ã level2_descriptions
        async function loadLevel2Details(level2) {
            try {
                const response = await fetch(`/level2-descriptions/${encodeURIComponent(level2)}`);
                if (response.ok) {
                    const data = await response.json();
                    return data.details || {};
                }
            } catch (error) {
                console.error(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫ –¥–ª—è ${level2}:`, error);
            }
            return {};
        }
        
        // Update product image based on selected color - –ë–ï–ó –•–ê–†–î–ö–û–î–ê!
        async function updateProductImage(productId, selectedColor, options = {}) {
            const waitForLoad = options.waitForLoad === true;
            
            // –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
            if (!selectedColor || selectedColor === 'undefined' || selectedColor === 'null' || selectedColor === undefined) {
                console.warn(`‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ü–≤–µ—Ç –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ID ${productId}:`, selectedColor, typeof selectedColor);
                return;
            }
            
            console.log(`üîç updateProductImage –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ${productId} —Å —Ü–≤–µ—Ç–æ–º:`, selectedColor, typeof selectedColor);
            
            // –ù–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞
            const productCard = document.querySelector(`[data-product-id="${productId}"]`)?.closest('.product-card');
            if (!productCard) {
                console.warn(`–ö–∞—Ä—Ç–æ—á–∫–∞ —Ç–æ–≤–∞—Ä–∞ —Å ID ${productId} –Ω–µ –Ω–∞–π–¥–µ–Ω–∞`);
                return;
            }
            
            // –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ –∏–∑ data-model –∞—Ç—Ä–∏–±—É—Ç–∞
            const variantsElement = productCard.querySelector('.product-variants');
            if (!variantsElement || !variantsElement.dataset.model) {
                console.warn(`–ú–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è ID ${productId}`);
                return;
            }
            
            const brandModel = variantsElement.dataset.model; // "Apple iPhone 16 Pro"
            
            // –ü–æ–ª—É—á–∏—Ç—å model_key –∏–∑ –Ω–∞–∑–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
            const modelKey = getModelKey(brandModel);
            if (!modelKey) {
                console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å model_key –¥–ª—è ${brandModel}`);
                return;
            }
            
            // –ò—Å–ø–æ–ª—å–∑—É–µ–º –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –¥–ª—è API –∑–∞–ø—Ä–æ—Å–∞
            const apiColor = selectedColor; // "Deep Blue"
            
            console.log(`üì∏ –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è ${brandModel} —Ü–≤–µ—Ç–∞ ${selectedColor} -> ${apiColor} (modelKey: ${modelKey})`);
            
            try {
                // –ü–æ–ª—É—á–∏—Ç—å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è—Ö –∏–∑ API
                const apiUrl = `/product-images/${modelKey}/${encodeURIComponent(apiColor)}`;
                console.log(`üåê API –∑–∞–ø—Ä–æ—Å: ${apiUrl}`);
                
                const response = await fetch(apiUrl);
                
                console.log(`üì° API –æ—Ç–≤–µ—Ç: ${response.status} ${response.statusText}`);
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const imageData = await response.json();
                console.log(`üìä –î–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:`, imageData);
                
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ image_paths —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
                if (!imageData.image_paths || !Array.isArray(imageData.image_paths)) {
                    console.warn(`‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è ${brandModel} —Ü–≤–µ—Ç–∞ ${selectedColor}:`, imageData);
                    console.warn(`‚ùå image_paths –Ω–µ —è–≤–ª—è–µ—Ç—Å—è –º–∞—Å—Å–∏–≤–æ–º:`, imageData.image_paths);
                    throw new Error('–ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π');
                }
                
                // –î–æ–±–∞–≤–∏—Ç—å timestamp –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è
                const timestampedPaths = imageData.image_paths.map(img => `${img}?v=${Date.now()}`);
                
                // –û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ –∫–∞—Ä—É—Å–µ–ª–∏
                const carousel = productCard.querySelector('.product-image-carousel');
                if (carousel) {
                    // Placeholder –ø–æ–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è
                    const loadingPlaceholder = carousel.querySelector('.loading-placeholder');
                    if (loadingPlaceholder && !waitForLoad) {
                        loadingPlaceholder.style.display = 'none';
                    } else if (loadingPlaceholder && waitForLoad) {
                        loadingPlaceholder.style.display = 'block';
                    }

                    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —É–∂–µ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–ª–∞–π–¥–æ–≤
                    let slideContainer = carousel.querySelector('.image-slide-container');
                    
                    if (slideContainer) {
                        // –û–±–Ω–æ–≤–ª—è–µ–º —Å—É—â–µ—Å—Ç–≤—É—é—â—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É —Å–ª–∞–π–¥–æ–≤
                        const slideWrapper = slideContainer.querySelector('.image-slide-wrapper');
                        const slideItems = slideContainer.querySelectorAll('.image-slide-item');
                        
                        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–µ —Å–ª–∞–π–¥—ã
                        slideItems.forEach(item => item.remove());
                        
                        // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ —Å–ª–∞–π–¥—ã –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ü–≤–µ—Ç–∞
                        timestampedPaths.forEach((imageSrc, index) => {
                            const slideItem = document.createElement('div');
                            slideItem.className = 'image-slide-item';
                            if (index === 0) {
                                slideItem.classList.add('fade-in');
                            }
                            
                            const img = document.createElement('img');
                            img.src = imageSrc;
                            img.alt = `Product image ${index + 1}`;
                            img.style.opacity = index === 0 ? '1' : '0';
                            
                            slideItem.appendChild(img);
                            slideWrapper.appendChild(slideItem);
                        });
                        
                        // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –ø–æ–∑–∏—Ü–∏—é —Å–ª–∞–π–¥–µ—Ä–∞ –Ω–∞ –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        slideWrapper.style.transform = 'translateX(0%)';
                        
                    } else {
                        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ã—á–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                        const mainImg = carousel.querySelector('.product-img');
                        if (mainImg && timestampedPaths[0]) {
                            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –Ω–æ–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                            mainImg.style.opacity = '0';
                            mainImg.onload = () => {
                                if (loadingPlaceholder) loadingPlaceholder.style.display = 'none';
                                mainImg.style.opacity = '1';
                            };
                            mainImg.src = timestampedPaths[0];
                        } else {
                            // –ü–æ–ø—Ä–æ–±—É–µ–º —Å–æ–∑–¥–∞—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ, –µ—Å–ª–∏ –µ–≥–æ –Ω–µ—Ç
                            if (!mainImg && timestampedPaths[0]) {
                                const newImg = document.createElement('img');
                                newImg.alt = `${brandModel} ${selectedColor}`;
                                newImg.className = 'product-img';
                                newImg.style.cssText = 'width: 90%; height: 90%; object-fit: contain; border-radius: 15px; margin: 5%; opacity: 0;';
                                newImg.onload = () => {
                                    if (loadingPlaceholder) loadingPlaceholder.style.display = 'none';
                                    newImg.style.opacity = '1';
                                };
                                newImg.src = timestampedPaths[0];
                                
                                carousel.appendChild(newImg);
                            }
                        }
                    }
                    
                    // –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∫–∞—Ä—É—Å–µ–ª–∏
                    const indicatorsContainer = carousel.querySelector('.image-indicators');
                    if (timestampedPaths.length > 1) {
                        indicatorsContainer.innerHTML = timestampedPaths.map((_, index) => 
                            `<span class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`
                        ).join('');
                        
                        // –ü–æ–∫–∞–∑–∞—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                        const prevNav = carousel.querySelector('.image-nav.prev');
                        const nextNav = carousel.querySelector('.image-nav.next');
                        if (prevNav && nextNav) {
                            prevNav.style.display = 'block';
                            nextNav.style.display = 'block';
                        }
                    } else {
                        indicatorsContainer.innerHTML = '';
                        // –°–∫—Ä—ã—Ç—å –Ω–∞–≤–∏–≥–∞—Ü–∏—é –µ—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –æ–¥–Ω–æ
                        const prevNav = carousel.querySelector('.image-nav.prev');
                        const nextNav = carousel.querySelector('.image-nav.next');
                        if (prevNav && nextNav) {
                            prevNav.style.display = 'none';
                            nextNav.style.display = 'none';
                        }
                    }
                    
                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –ø—É—Ç–∏ –¥–ª—è changeImage —Ñ—É–Ω–∫—Ü–∏–∏
                    window[`${productId}-${selectedColor}`] = timestampedPaths;
                }
                
                console.log(`‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è ${brandModel} —Ü–≤–µ—Ç–∞ ${selectedColor}`);
                
            } catch (error) {
                console.error(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è ${brandModel} —Ü–≤–µ—Ç–∞ ${selectedColor}:`, error);
                const carousel = productCard.querySelector('.product-image-carousel');
                if (carousel) {
                    // –°–∫—Ä—ã—Ç—å loading placeholder
                    const placeholder = carousel.querySelector('.loading-placeholder');
                    if (placeholder) {
                        placeholder.style.display = 'none';
                    }
                    
                    // –î–æ–±–∞–≤–∏—Ç—å fallback –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ (–ø—Ä–æ—Å—Ç–æ placeholder)
                    const mainImg = carousel.querySelector('.product-img');
                    if (mainImg) {
                        mainImg.src = `/static/images/products/placeholder.jpg?v=${Date.now()}`;
                    } else {
                        // –ü–æ–∫–∞–∑–∞—Ç—å placeholder –µ—Å–ª–∏ –Ω–µ—Ç –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
                        const placeholder = carousel.querySelector('.loading-placeholder');
                        if (placeholder) {
                            placeholder.style.display = 'block';
                            placeholder.innerHTML = '<img src="/static/images/logo.jpg" alt="–ù–µ—Ç —Ñ–æ—Ç–æ">';
                        }
                    }
                }
            }
        }
        
        // –ü–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        function showLoadingPlaceholders() {
            console.log('üîÑ –ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∑–∞–≥—Ä—É–∑—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π...');
            
            document.querySelectorAll('.product-img').forEach(img => {
                const placeholder = img.nextElementSibling;
                if (placeholder && placeholder.classList.contains('loading-placeholder')) {
                    // –°–∫—Ä—ã—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫
                    img.style.opacity = '0';
                    placeholder.style.display = 'flex';
                    
                    // –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, –∑–∞–≥—Ä—É–∂–µ–Ω–æ –ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    if (img.complete && img.naturalHeight !== 0) {
                        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ, –ø–æ–∫–∞–∑–∞—Ç—å –µ–≥–æ
                        setTimeout(() => {
                            img.style.opacity = '1';
                            placeholder.style.display = 'none';
                        }, 100);
                    } else {
                        // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –µ—â–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è, –¥–æ–±–∞–≤–∏—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫
                        img.onload = function() {
                            this.style.opacity = '1';
                            this.nextElementSibling.style.display = 'none';
                        };
                    }
                }
            });
        }
        
        // Initialize variant buttons event listeners
        function initVariantButtons() {
            document.addEventListener('click', function(event) {
                if (event.target.classList.contains('variant-btn')) {
                    event.preventDefault();
                    event.stopPropagation();
                    
                    const buttonElement = event.target;
                    const productId = buttonElement.closest('.product-variants').dataset.productId;
                    
                    toggleVariant(productId, buttonElement);
                }
            });
        }
        
        // Call initVariantButtons when page loads
        initVariantButtons();
        
        // Function to get CSS color based on color name
        function getColorStyle(colorName) {
            if (!colorName || colorName === 'Default' || colorName === '–ù–µ —É–∫–∞–∑–∞–Ω') {
                return '#E9ECEF'; // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Å–µ—Ä—ã–π —Ü–≤–µ—Ç
            }
            
            // –û—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è Titanium Desert
            if (colorName.toLowerCase().includes('titanium') || colorName.toLowerCase().includes('desert')) {
                console.log('üîç getColorStyle –≤—ã–∑–≤–∞–Ω–∞ –¥–ª—è:', colorName, '—Ç–∏–ø:', typeof colorName);
            }
            
            const colorMap = {
                // iPhone colors
                'ultramarine': '#a4b6f6', // –£–ª—å—Ç—Ä–∞–º–∞—Ä–∏–Ω–æ–≤—ã–π
                'black': '#000000', 'white': '#FFFFFF', 'pink': '#FFB6C1', // –°–≤–µ—Ç–ª–æ —Ä–æ–∑–æ–≤—ã–π
                'titanium-black': '#000000', // –ß–∏—Å—Ç–æ —á–µ—Ä–Ω—ã–π
                'titanium-white': '#FFFFFF', 'titanium-natural': '#979792', 'titanium-desert': '#d0b6a8',
                // –î—É–±–ª–∏—Ä—É–µ–º –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–∞–ø–∏—Å–∞–Ω–∏—è
                'Titanium Desert': '#d0b6a8', 'TITANIUM-DESERT': '#d0b6a8',
                'deep-blue': '#1B2951', 'cosmic-orange': '#FF6B35', 'silver': '#E8E8E8', // –°–≤–µ—Ç–ª–æ —Å–µ—Ä–µ–±—Ä–∏—Å—Ç—ã–π
                'teal': '#20B2AA', // –ë–∏—Ä—é–∑–æ–≤—ã–π

                // New colors from DB
                'space black': '#0b0b0b',
                'starlight': '#F5E7D3',
                'midnight': '#0a0f1f',
                'sky blue': '#87CEEB',
                'mist blue': '#9BB7D4',
                'sage': '#A3B18A',
                'lavender': '#B7A1E3',
                'light gold': '#E6C87A',
                'cloud white': '#F9FAFB',
                'blue': '#2563EB',
                'green': '#059669',
                
                // MacBook colors
                'space-gray': '#7F7F7F', 'silver': '#C0C0C0',
                
                // iPad colors
                'black': '#000000', 'blue': '#2563EB',
                
                // Other common colors
                'gray': '#6B7280', 'grey': '#6B7280', 'green': '#059669',
                'purple': '#7C3AED', 'gold': '#F59E0B', 'red': '#DC2626', 'orange': '#EA580C'
            };
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ
            if (colorMap[colorName.toLowerCase()]) {
                const result = colorMap[colorName.toLowerCase()];
                if (colorName.toLowerCase().includes('titanium') || colorName.toLowerCase().includes('desert')) {
                    console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ —Ç–æ—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ:', colorName.toLowerCase(), '->', result);
                }
                return result;
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ (–¥–ª—è —Å–æ—Å—Ç–∞–≤–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –∫–∞–∫ "titanium-black")
            for (const [key, color] of Object.entries(colorMap)) {
                if (colorName.toLowerCase().includes(key)) {
                    if (colorName.toLowerCase().includes('titanium') || colorName.toLowerCase().includes('desert')) {
                        console.log('‚úÖ –ù–∞–π–¥–µ–Ω–æ —á–∞—Å—Ç–∏—á–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ:', key, '–¥–ª—è', colorName, '->', color);
                    }
                    return color;
                }
            }
            
            return '#6B7280'; // –¶–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (—Å–µ—Ä—ã–π)
        }
        
        // Function to determine text color based on background color
        function getTextColor(backgroundColor) {
            // –ö–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ–º hex –≤ RGB
            const hex = backgroundColor.slice(1);
            const r = parseInt(hex.substr(0, 2), 16);
            const g = parseInt(hex.substr(2, 2), 16);
            const b = parseInt(hex.substr(4, 2), 16);
            
            // –í—ã—á–∏—Å–ª—è–µ–º —è—Ä–∫–æ—Å—Ç—å
            const brightness = ((r * 299) + (g * 587) + (b * 114)) / 1000;
            
            return brightness > 128 ? '#000000' : '#FFFFFF';
        }
        
        // Function to get English label for color
        function getColorLabel(colorName) {
            if (!colorName || colorName === 'Default' || colorName === '–ù–µ —É–∫–∞–∑–∞–Ω') {
                return 'Default';
            }
            
            const colorLabels = {
                'ultramarine': 'Ultramarine',
                'black': 'Black',
                'white': 'White',
                'pink': 'Pink',
                'yellow': 'Yellow',
                'teal': 'Teal',
                'titanium-black': 'Titanium Black',
                'titanium-white': 'Titanium White',
                'titanium-natural': 'Titanium Natural',
                'titanium-desert': 'Titanium Desert',
                'deep-blue': 'Deep Blue',
                'cosmic-orange': 'Cosmic Orange',
                'silver': 'Silver',
                'space-gray': 'Space Gray',
                'blue': 'Blue',
                'gray': 'Gray',
                'grey': 'Grey',
                'green': 'Green',
                'purple': 'Purple',
                'gold': 'Gold',
                'red': 'Red',
                'orange': 'Orange',

                // New labels
                'space black': 'Space Black',
                'starlight': 'Starlight',
                'midnight': 'Midnight',
                'sky blue': 'Sky Blue',
                'mist blue': 'Mist Blue',
                'sage': 'Sage',
                'lavender': 'Lavender',
                'light gold': 'Light Gold',
                'cloud white': 'Cloud White'
            };
            
            return colorLabels[colorName.toLowerCase()] || colorName;
        }
        
        // Initialize variants and colors for all cards
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ —Å—Ä–∞–∑—É –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–∞—Ä—Ç–æ—á–∫–∏
        async function loadFirstColorImage(productId, brand, model) {
            try {
                console.log(`üñºÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ —Ü–≤–µ—Ç–∞ –¥–ª—è ${brand} ${model}...`);
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º model_key
                const modelKey = getModelKey(`${brand} ${model}`);
                if (!modelKey) {
                    console.warn(`–ù–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å model_key –¥–ª—è ${brand} ${model}`);
                    return;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ü–≤–µ—Ç –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é (–æ–±—ã—á–Ω–æ Black –∏–ª–∏ –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π)
                const defaultColors = ['Black', 'black', 'White', 'white', 'Space Black', 'space-black'];
                
                for (const colorName of defaultColors) {
                    try {
                        // –ü—ã—Ç–∞–µ–º—Å—è –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞
                        const response = await fetch(`/product-images/${modelKey}/${encodeURIComponent(colorName)}`);
                        
                        if (response.ok) {
                            const imageData = await response.json();
                            const timestampedPaths = imageData.image_paths.map(img => `${img}?v=${Date.now()}`);
                            
                            // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ –∫–∞—Ä—Ç–æ—á–∫–µ
                            const carousel = document.querySelector(`[data-product-id="${productId}"]`);
                            if (carousel) {
                                const placeholder = carousel.querySelector('.loading-placeholder');
                                if (placeholder) {
                                    placeholder.style.display = 'none';
                                }
                                
                                // –°–æ–∑–¥–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                const mainImg = document.createElement('img');
                                mainImg.className = 'product-img';
                                mainImg.alt = `${brand} ${model}`;
                                mainImg.src = timestampedPaths[0];
                                mainImg.style.opacity = '0';
                                mainImg.onerror = 'this.style.display="none"; this.nextElementSibling.style.display="block";';
                                
                                carousel.insertBefore(mainImg, carousel.querySelector('.image-indicators'));
                                
                                // –ü–ª–∞–≤–Ω–æ–µ –ø–æ—è–≤–ª–µ–Ω–∏–µ
                                setTimeout(() => {
                                    mainImg.style.opacity = '1';
                                }, 100);
                                
                                // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–∞—Ä—É—Å–µ–ª–∏ –µ—Å–ª–∏ –µ—Å—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                                if (timestampedPaths.length > 1) {
                                    const indicatorsContainer = carousel.querySelector('.image-indicators');
                                    indicatorsContainer.innerHTML = timestampedPaths.map((_, index) => 
                                        `<span class="indicator ${index === 0 ? 'active' : ''}" data-index="${index}"></span>`
                                    ).join('');
                                    
                                    const prevNav = carousel.querySelector('.image-nav.prev');
                                    const nextNav = carousel.querySelector('.image-nav.next');
                                    if (prevNav && nextNav) {
                                        prevNav.style.display = 'block';
                                        nextNav.style.display = 'block';
                                    }
                                    
                                    // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –¥–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ changeImage
                                    window[`${productId}-${colorName}`] = timestampedPaths;
                                }
                            }
                            
                            console.log(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è ${brand} ${model} —Ü–≤–µ—Ç–∞ ${colorName}`);
                            break; // –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∑–∏–ª–∏, –≤—ã—Ö–æ–¥–∏–º –∏–∑ —Ü–∏–∫–ª–∞
                            
                        }
                    } catch (error) {
                        // –¶–≤–µ—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω, –ø—Ä–æ–±—É–µ–º —Å–ª–µ–¥—É—é—â–∏–π
                        continue;
                    }
                }
                
            } catch (error) {
                console.warn(`‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ø–µ—Ä–≤–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ${productId}:`, error);
            }
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —Ü–≤–µ—Ç–∞
        async function loadDefaultImages() {
            console.log('üñºÔ∏è –ó–∞–≥—Ä—É–∂–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤...');
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –ø—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∏–ª–∏ –∫–æ –≤—Å–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
            document.querySelectorAll('.product-img').forEach(img => {
                img.style.cssText = 'width: 90%; height: 90%; object-fit: contain; border-radius: 15px; margin: 5%; transition: opacity 0.2s ease-in-out;';
            });
            
            // –°–Ω–∞—á–∞–ª–∞ –ø–æ–∫–∞–∑–∞—Ç—å –∑–∞–≥—Ä—É–∑—á–∏–∫–∏ –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            showLoadingPlaceholders();
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–≤–∞–π–ø –¥–ª—è –≤—Å–µ—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π
            setTimeout(() => {
                addSwipeSupport();
            }, 200);
            
            for (const card of document.querySelectorAll('.product-card')) {
                const colorButton = card.querySelector('.variant-btn.color-btn.active');
                if (colorButton) {
                    const productId = card.querySelector('.product-variants')?.dataset.productId || 
                                     card.querySelector('[data-product-id]')?.dataset.productId;
                    
                    const selectedColor = colorButton.dataset.color || colorButton.dataset.value;
                    
                    if (productId && selectedColor) {
                        try {
                            // –ñ–¥–µ–º –ø–æ–ª–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ –Ω—É–∂–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –ø–µ—Ä–µ–¥ –ø–æ–∫–∞–∑–æ–º
                            await updateProductImage(productId, selectedColor, { waitForLoad: true });
                        } catch (error) {
                            console.warn(`–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–æ–≤–∞—Ä–∞ ${productId} —Ü–≤–µ—Ç–∞ ${selectedColor}:`, error);
                        }
                    }
                }
            }
            
            console.log('‚úÖ –ó–∞–≤–µ—Ä—à–µ–Ω–∞ –∑–∞–≥—Ä—É–∑–∫–∞ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é');
        }

        async function initializeDefaultColors() {
            // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API
            for (const card of document.querySelectorAll('.product-card')) {
                const variantsElement = card.querySelector('[data-model]');
                if (variantsElement) {
                    const model = variantsElement.dataset.model;
                    try {
                        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã —á–µ—Ä–µ–∑ –Ω–æ–≤—ã–π API
                        await loadVariantsForModel(card, model);
                    } catch (error) {
                        console.warn('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –¥–ª—è –º–æ–¥–µ–ª–∏:', model, error);
                    }
                }
            }
        }
        
        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –º–æ–¥–µ–ª–∏
        async function loadVariantsForModel(productCard, model) {
            console.log('üîÑ –ó–∞–≥—Ä—É–∂–∞–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –¥–ª—è –º–æ–¥–µ–ª–∏:', model);
            
            const variantsElement = productCard.querySelector('.product-variants');
            if (!variantsElement) return;
            
            try {
                const response = await fetch(`/products/${encodeURIComponent(model)}/variants`);
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –≤–∞—Ä–∏–∞–Ω—Ç—ã:', data);
                
                // –û—á–∏—â–∞–µ–º —ç–ª–µ–º–µ–Ω—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
                variantsElement.innerHTML = '';
                
                if (data.variants && data.variants.length > 0) {
                    // –ì—Ä—É–ø–ø–∏—Ä—É–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã –ø–æ —Ü–≤–µ—Ç–∞–º
                    const colorGroups = {};
                    
                    data.variants.forEach(variant => {
                        const color = variant.color && variant.color.trim() !== '' ? variant.color : null;
                        if (color) { // –¢–æ–ª—å–∫–æ –¥–æ–±–∞–≤–ª—è–µ–º –≤–∞—Ä–∏–∞–Ω—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Ü–≤–µ—Ç–∞–º–∏
                            if (!colorGroups[color]) {
                                colorGroups[color] = [];
                            }
                            colorGroups[color].push(variant);
                        }
                    });
                    
                    console.log('üé® –ì—Ä—É–ø–ø—ã —Ü–≤–µ—Ç–æ–≤:', Object.keys(colorGroups));
                    
                    // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–µ —Ü–≤–µ—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ —Ü–≤–µ—Ç–æ–≤
                    const colorButtons = Object.keys(colorGroups).map(color => {
                        const variants = colorGroups[color];
                        const activeClass = Object.keys(colorGroups).indexOf(color) === 0 ? 'active' : '';
                        
                        // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—É—é —Ü–≤–µ—Ç–Ω—É—é –∫–Ω–æ–ø–∫—É
                        const colorStyle = getColorStyle(color);
                        const label = getColorLabel(color);
                        const textColor = getTextColor(colorStyle);
                        
                        return `
                            <button class="variant-btn color-btn ${activeClass}" 
                                    data-color="${color}" 
                                    data-model="${model}"
                                    data-type="color"
                                    style="background-color: ${(color && color.toLowerCase().includes('titanium') && color.toLowerCase() && color.toLowerCase().includes('desert')) ? '#d0b6a8' : colorStyle}; color: ${textColor}; border-color: ${(color && color.toLowerCase().includes('titanium') && color.toLowerCase().includes('desert')) ? '#d0b6a8' : colorStyle};"
                                    title="${label}">
                            </button>
                        `;
                    }).join('');
                    
                    // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –ø–∞–º—è—Ç–∏ (—Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)
                    const memoryOptions = [...new Set(data.variants
                        .map(v => v.memory)
                        .filter(memory => memory && memory.trim() !== ''))];
                    const memoryButtons = memoryOptions.map((memory, index) => {
                        const activeClass = index === 0 ? 'active' : '';
                        return `
                            <button class="variant-btn memory-btn ${activeClass}" 
                                    data-memory="${memory}" 
                                    data-model="${model}"
                                    data-type="memory">
                                ${memory}
                            </button>
                        `;
                    }).join('');
                    
                    // –°–æ–∑–¥–∞–µ–º –∫—Ä–∞—Å–∏–≤—ã–µ –∫–Ω–æ–ø–∫–∏ SIM (—Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏)
                    const simOptions = [...new Set(data.variants
                        .map(v => v.sim_type)
                        .filter(sim => sim && sim.trim() !== ''))];
                    // –ú–∞–ø–ø–∏–Ω–≥ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–∏–ø–æ–≤ SIM
                    const simLabels = {
                        'Single SIM': 'SIM + eSIM',
                        'eSIM': 'Dual eSIM',
                        'Dual SIM': 'Dual SIM'
                    };
                    
                    const simButtons = simOptions.map((sim, index) => {
                        const activeClass = index === 0 ? 'active' : '';
                        const displayLabel = simLabels[sim] || sim;
                        return `
                            <button class="variant-btn sim-btn ${activeClass}" 
                                    data-sim="${sim}" 
                                    data-model="${model}"
                                    data-type="sim">
                                ${displayLabel}
                            </button>
                        `;
                    }).join('');
                    
                    // –°–æ–∑–¥–∞–µ–º HTML —Ç–æ–ª—å–∫–æ –¥–ª—è —ç–ª–µ–º–µ–Ω—Ç–æ–≤ —Å –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏
                    let htmlContent = '';
                    
                    if (colorButtons) {
                        htmlContent += `
                            <div class="variant-group color-group">
                                <label>–¶–≤–µ—Ç:</label>
                                <div class="variant-buttons">
                                    ${colorButtons}
                                </div>
                            </div>
                        `;
                    }
                    
                    if (memoryButtons) {
                        htmlContent += `
                            <div class="variant-group memory-group">
                                <label>–ü–∞–º—è—Ç—å:</label>
                                <div class="variant-buttons">
                                    ${memoryButtons}
                                </div>
                            </div>
                        `;
                    }
                    
                    if (simButtons) {
                        htmlContent += `
                            <div class="variant-group sim-group">
                                <label>–°–ò–ú:</label>
                                <div class="variant-buttons">
                                    ${simButtons}
                                </div>
                            </div>
                        `;
                    }
                    
                    
                    variantsElement.innerHTML = htmlContent;
                    
                    // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π –¥–ª—è –Ω–æ–≤—ã—Ö –∫–Ω–æ–ø–æ–∫
                    addVariantEventListeners(model, colorGroups);
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                    updateVariantPrice(model, colorGroups);
                    
                } else {
                    variantsElement.innerHTML = '<div class="no-variants">–í–∞—Ä–∏–∞–Ω—Ç—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</div>';
                }
                
                    } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:', error);
                variantsElement.innerHTML = '<div class="error">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤</div>';
            }
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
        function addVariantEventListeners(model, colorGroups) {
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ü–≤–µ—Ç–∞
            document.querySelectorAll(`[data-model="${model}"][data-type="color"]`).forEach(button => {
                button.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–∞
                    document.querySelectorAll(`[data-model="${model}"][data-type="color"]`).forEach(btn => btn.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                    updateVariantPrice(model, colorGroups);
                    
                    // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è —Ü–≤–µ—Ç–∞
                    const selectedColor = this.dataset.color;
                    const productCard = this.closest('.product-card');
                    if (productCard) {
                        // –ü–æ–ª—É—á–∞–µ–º product-id –∏–∑ –∫–∞—Ä—Ç–æ—á–∫–∏
                        const productIdMatch = productCard.outerHTML.match(/data-product-id="(\d+)"/);
                        if (productIdMatch) {
                            const productId = productIdMatch[1];
                            updateProductImage(productId, selectedColor);
                        }
                    }
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞–º—è—Ç–∏
            document.querySelectorAll(`[data-model="${model}"][data-type="memory"]`).forEach(button => {
                button.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ –ø–∞–º—è—Ç–∏
                    document.querySelectorAll(`[data-model="${model}"][data-type="memory"]`).forEach(btn => btn.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                    updateVariantPrice(model, colorGroups);
                });
            });
            
            // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –∏–∑–º–µ–Ω–µ–Ω–∏—è SIM
            document.querySelectorAll(`[data-model="${model}"][data-type="sim"]`).forEach(button => {
                button.addEventListener('click', function() {
                    // –£–±–∏—Ä–∞–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å —Å –¥—Ä—É–≥–∏—Ö –∫–Ω–æ–ø–æ–∫ SIM
                    document.querySelectorAll(`[data-model="${model}"][data-type="sim"]`).forEach(btn => btn.classList.remove('active'));
                    // –î–æ–±–∞–≤–ª—è–µ–º –∞–∫—Ç–∏–≤–Ω—ã–π –∫–ª–∞—Å—Å –∫ –Ω–∞–∂–∞—Ç–æ–π –∫–Ω–æ–ø–∫–µ
                    this.classList.add('active');
                    
                    // –û–±–Ω–æ–≤–ª—è–µ–º —Ü–µ–Ω—É –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                    updateVariantPrice(model, colorGroups);
                });
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω—ã –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ –≤–∞—Ä–∏–∞–Ω—Ç–∞
        function updateVariantPrice(model, colorGroups) {
            const activeColorButton = document.querySelector(`[data-model="${model}"][data-type="color"].active`);
            const activeMemoryButton = document.querySelector(`[data-model="${model}"][data-type="memory"].active`);
            const activeSimButton = document.querySelector(`[data-model="${model}"][data-type="sim"].active`);
            
            if (!activeColorButton || !activeMemoryButton || !activeSimButton) return;
            
            const selectedColor = activeColorButton.dataset.color;
            const selectedMemory = activeMemoryButton.dataset.memory;
            const selectedSim = activeSimButton.dataset.sim;
            
            // –ù–∞—Ö–æ–¥–∏–º —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –≤–∞—Ä–∏–∞–Ω—Ç
            const variants = colorGroups[selectedColor] || [];
            const matchedVariant = variants.find(v => 
                v.memory === selectedMemory && v.sim_type === selectedSim
            );
            
            // –ï—Å–ª–∏ —Ç–æ—á–Ω–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞
            const fallbackVariant = matchedVariant || variants[0];
            
            if (fallbackVariant) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Å–Ω–æ–≤–Ω—É—é —Ü–µ–Ω—É –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Ç–æ–≤–∞—Ä–∞
                const productCard = document.querySelector(`[data-model="${model}"]`).closest('.product-card');
                const currentPriceElement = productCard.querySelector('.current-price');
                
                if (currentPriceElement) {
                    const price = Math.round(fallbackVariant.price).toLocaleString();
                    currentPriceElement.textContent = `${price} ‚ÇΩ`;
                }
                
                console.log('üí± –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞:', fallbackVariant.price, '‚ÇΩ');
                
                if (!matchedVariant) {
                    console.log('‚ÑπÔ∏è –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω –ø–µ—Ä–≤—ã–π –¥–æ—Å—Ç—É–ø–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è —Ü–≤–µ—Ç–∞:', selectedColor);
                }
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –µ—Å–ª–∏ –æ–Ω–∏ –µ—Å—Ç—å
                if (fallbackVariant.images && fallbackVariant.images.length > 0) {
                    const productCard = document.querySelector(`[data-model="${model}"]`).closest('.product-card');
                    if (productCard) {
                        const carousel = productCard.querySelector('.product-image-carousel');
                        if (carousel) {
                            const mainImg = carousel.querySelector('.product-img');
                            if (mainImg) {
                                mainImg.src = fallbackVariant.images[0] + `?v=${Date.now()}`;
                                console.log('üñºÔ∏è –û–±–Ω–æ–≤–ª–µ–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –¥–ª—è —Ü–≤–µ—Ç–∞:', selectedColor);
                            }
                        }
                    }
                }
            } else {
                console.warn('‚ùå –í–∞—Ä–∏–∞–Ω—Ç –Ω–µ –Ω–∞–π–¥–µ–Ω:', {selectedColor, selectedMemory, selectedSim});
            }
        }
        
        async function createColorButtonsForProduct(productCard, productId) {
            console.log('üé® –ù–∞—á–∏–Ω–∞–µ–º —Å–æ–∑–¥–∞–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–æ–≤ –¥–ª—è —Ç–æ–≤–∞—Ä–∞', productId);
            
            // –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ –∏–∑ data-model –∞—Ç—Ä–∏–±—É—Ç–∞
            const variantsElement = productCard.querySelector('.product-variants');
            if (!variantsElement || !variantsElement.dataset.model) {
                console.log('‚ùå –≠–ª–µ–º–µ–Ω—Ç —Å –º–æ–¥–µ–ª—å—é –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            const brandModel = variantsElement.dataset.model; // "Apple iPhone 16 Pro"
            console.log('üì± –ù–∞–π–¥–µ–Ω–∞ –º–æ–¥–µ–ª—å:', brandModel);
            
            // –ü–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç–æ–≤—É—é —Å—Ö–µ–º—É –∏–∑ API —Å –ø–æ–ª–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ü–≤–µ—Ç–∞—Ö
            const modelKey = getModelKey(brandModel);
            console.log('üîë –û–ø—Ä–µ–¥–µ–ª–µ–Ω –∫–ª—é—á –º–æ–¥–µ–ª–∏:', modelKey);
            let colorsData = [];

            if (modelKey) {
                try {
                    const response = await fetch(`/color-schemes/${modelKey}`);
                    if (response.ok) {
                        const data = await response.json();
                        // –ò–∑–≤–ª–µ–∫–∞–µ–º –ø–æ–ª—è value –∏–∑ –æ–±—ä–µ–∫—Ç–æ–≤ —Ü–≤–µ—Ç–æ–≤
                        colorsData = data.colors.map(color => color.value);
                        console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã —Ü–≤–µ—Ç–∞:', colorsData);
                        console.log('üß™ –¢–µ—Å—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏—è —Ü–≤–µ—Ç–∞:', colorsData[0], typeof colorsData[0]);
                    } else {
                        console.warn(`–¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è ${modelKey}`);
                    }
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã:', error);
                }
            }

            // –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å —Ü–≤–µ—Ç–∞ –∏–∑ API, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å fallback
            if (colorsData.length === 0) {
                colorsData = ['black'];
            }

            // –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–Ω–æ–ø–æ–∫ —Ü–≤–µ—Ç–æ–≤
            const variantGroups = productCard.querySelectorAll('.variant-group');
            let colorContainer = null;
            for (const group of variantGroups) {
                const label = group.querySelector('label');
                if (label && label.textContent === '–¶–≤–µ—Ç:') {
                    colorContainer = group.querySelector('.variant-buttons');
                    break;
                }
            }
            if (!colorContainer) {
                console.log('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ü–≤–µ—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
                return;
            }
            
            console.log('üé® –ù–∞–π–¥–µ–Ω –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä —Ü–≤–µ—Ç–æ–≤, –¥–∞–Ω–Ω—ã–µ —Ü–≤–µ—Ç–æ–≤:', colorsData);
            
            // –¢–µ—Å—Ç–∏—Ä—É–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –Ω–∞ –∏–∑–≤–µ—Å—Ç–Ω—ã—Ö —Ü–≤–µ—Ç–∞—Ö
            console.log('üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–π —Ü–≤–µ—Ç–æ–≤:');
            console.log('titanium-black ->', getColorStyle('titanium-black'));
            console.log('titanium-desert ->', getColorStyle('titanium-desert'));
            console.log('Titanium Desert ->', getColorStyle('Titanium Desert'));
            console.log('black ->', getColorStyle('black'));
            console.log('white ->', getColorStyle('white'));
            console.log('deep-blue ->', getColorStyle('deep-blue'));
            
            // –°–æ–∑–¥–∞—Ç—å HTML –∏ –¥–æ–±–∞–≤–∏—Ç—å —Ü–≤–µ—Ç–Ω—ã–µ —Å—Ç–∏–ª–∏ –∫ –∫–Ω–æ–ø–∫–∞–º —Ü–≤–µ—Ç–æ–≤
            const colorButtonsHTML = colorsData.map((colorValue, index) => {
                const isActive = index === 0 ? 'active' : '';
                
                // –£–±–µ–¥–∏–º—Å—è —á—Ç–æ colorValue - —ç—Ç–æ —Å—Ç—Ä–æ–∫–∞, –∞ –Ω–µ –æ–±—ä–µ–∫—Ç
                const actualColorValue = typeof colorValue === 'string' ? colorValue : colorValue.value || colorValue.toString();
                console.log(`üé® –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Ü–≤–µ—Ç ${index}:`, { colorValue, actualColorValue, type: typeof colorValue });
                
                // –ü—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å –Ω–∞–∑–≤–∞–Ω–∏–µ —Ü–≤–µ—Ç–∞ –≤ –ø–∞–ø–∫—É: "titanium-black" -> "titanium-black"
                const folderName = actualColorValue.toLowerCase().replace(/\s+/g, '_');
                const colorStyle = getColorStyle(actualColorValue);
                const label = getColorLabel(actualColorValue);
                const textColor = getTextColor(colorStyle);
                
                console.log(`üé® –°–æ–∑–¥–∞—é –∫–Ω–æ–ø–∫—É –¥–ª—è —Ü–≤–µ—Ç–∞ ${actualColorValue}:`, { colorStyle, label, textColor });
                
                return `<button class="variant-btn color-btn ${isActive}" data-type="color" data-value="${actualColorValue}" data-color-folder="${folderName}" style="background-color: ${(actualColorValue && actualColorValue.toLowerCase().includes('titanium') && actualColorValue.toLowerCase().includes('desert')) ? '#d0b6a8' : colorStyle}; color: ${textColor}; border-color: ${(actualColorValue && actualColorValue.toLowerCase().includes('titanium') && actualColorValue.toLowerCase().includes('desert')) ? '#d0b6a8' : colorStyle};" title="${label}"></button>`;
            }).join('');
            
            console.log('üé® –°–æ–∑–¥–∞–Ω HTML –∫–Ω–æ–ø–æ–∫:', colorButtonsHTML);
            
            // –ó–∞–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            colorContainer.innerHTML = colorButtonsHTML;
            console.log('‚úÖ –¶–≤–µ—Ç–æ–≤—ã–µ –∫–Ω–æ–ø–∫–∏ –∑–∞–º–µ–Ω–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ');
            
            // –ü–µ—Ä–µ–∏–Ω–∏—Ç–æ—Ä–∏–∑–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            initVariantButtons(productCard.querySelector('.product-variants'));
        }
        
        async function createVariantsForProduct(productCard, productId) {
            // –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ –∏–∑ data-model –∞—Ç—Ä–∏–±—É—Ç–∞
            const variantsElement = productCard.querySelector('.product-variants');
            if (!variantsElement || !variantsElement.dataset.model) return;
            
            const brandModel = variantsElement.dataset.model; // "Apple iPhone 16 Pro"
            
            // –ü–æ–ª—É—á–∏—Ç—å —Å—Ö–µ–º—É –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑ API
            const modelKey = getModelKey(brandModel);
            let variantsData = {};
            
            if (modelKey) {
                try {
                    const response = await fetch(`/variant-schemes/${modelKey}`);
                    if (response.ok) {
                        const data = await response.json();
                        variantsData = data.variants;
                    } else {
                        console.warn(`–°—Ö–µ–º–∞ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –¥–ª—è ${modelKey}`);
                    }
                } catch (error) {
                    console.warn('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ö–µ–º—ã –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤:', error);
                }
            }
            
            // –ù–∞–π—Ç–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            const variantsContainer = productCard.querySelector('.product-variants');
            if (!variantsContainer) return;
            
            // –ï—Å–ª–∏ –Ω–µ—Ç –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –∏–∑ API, —Å–æ–∑–¥–∞—Ç—å –±–∞–∑–æ–≤—ã–π –Ω–∞–±–æ—Ä
            if (Object.keys(variantsData).length === 0) {
                variantsData = {
                    color: ["Black"],
                    capacity: ["128GB"]
                };
            }
            
            // –°–æ–∑–¥–∞—Ç—å HTML –¥–ª—è –≤—Å–µ—Ö –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤
            let variantsHtml = '';
            
            // –û–±—Ä–∞–±–æ—Ç–∞—Ç—å –∫–∞–∂–¥—ã–π —Ç–∏–ø –≤–∞—Ä–∏–∞–Ω—Ç–∞
            for (const [variantType, options] of Object.entries(variantsData)) {
                if (variantType === 'color' && (options === 'dynamic' || Array.isArray(options))) {
                    // –î–ª—è —Ü–≤–µ—Ç–æ–≤ –∏—Å–ø–æ–ª—å–∑—É–µ–º –¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é –∑–∞–≥—Ä—É–∑–∫—É –∏–∑ color schemes
                    variantsHtml += `
                        <div class="variant-group">
                            <label>–¶–≤–µ—Ç:</label>
                            <div class="variant-buttons">
                                <!-- –¶–≤–µ—Ç–∞ –±—É–¥—É—Ç –∑–∞–≥—Ä—É–∂–µ–Ω—ã —á–µ—Ä–µ–∑ createColorButtonsForProduct -->
                                <div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞ —Ü–≤–µ—Ç–æ–≤...</div>
                            </div>
                        </div>
                    `;
                    continue;
                }
                
                // –û–ø—Ä–µ–¥–µ–ª–∏—Ç—å –º–µ—Ç–∫—É –¥–ª—è —Ç–∏–ø–∞ –≤–∞—Ä–∏–∞–Ω—Ç–∞
                const labels = {
                    memory: '–ü–∞–º—è—Ç—å',
                    sim: 'SIM',
                    screen: '–î–∏–∞–≥–æ–Ω–∞–ª—å',
                    ram: 'RAM',
                    ssd: 'SSD',
                    color: '–¶–≤–µ—Ç',
                    capacity: '–û–±—ä–µ–º'
                };
                
                const label = labels[variantType] || variantType;
                
                // –°–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫–∏ –¥–ª—è –æ–ø—Ü–∏–π
                const buttons = Array.isArray(options) ? options : [];
                const buttonsHtml = buttons.map((option, index) => {
                    const isActive = index === 0 ? 'active' : '';
                    const dataAttr = variantType === 'color' ? `data-color-folder="${option.toLowerCase()}"` : '';
                    return `<button class="variant-btn ${isActive}" data-type="${variantType}" data-value="${option}" ${dataAttr}>${option}</button>`;
                }).join('');
                
                variantsHtml += `
                    <div class="variant-group">
                        <label>${label}:</label>
                        <div class="variant-buttons">${buttonsHtml}</div>
                    </div>
                `;
            }
            
            // –ó–∞–º–µ–Ω–∏—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
            variantsContainer.innerHTML = variantsHtml;
            
            // –ü–µ—Ä–µ–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
            initVariantButtons(variantsContainer);
            
            // –ó–¥–µ—Å—å —Ç–∞–∫–∂–µ –Ω—É–∂–Ω–æ —Å–æ–∑–¥–∞—Ç—å –∫–Ω–æ–ø–∫–∏ —Ü–≤–µ—Ç–æ–≤ –µ—Å–ª–∏ —ç—Ç–æ —Ü–≤–µ—Ç–æ–≤–æ–π —Ç–∏–ø
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ —Ü–≤–µ—Ç–æ–≤—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã (–º–∞—Å—Å–∏–≤ –∏–ª–∏ 'dynamic')
            if (variantsData.color && (Array.isArray(variantsData.color) || variantsData.color === 'dynamic')) {
                await createColorButtonsForProduct(productCard, productId);
            }
        }
        
        function getModelKey(brandModel) {
            // –ü—Ä–æ—Å—Ç–∞—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –Ω–∏–∂–Ω–∏–π —Ä–µ–≥–∏—Å—Ç—Ä + —É–¥–∞–ª–µ–Ω–∏–µ –ø—Ä–æ–±–µ–ª–æ–≤, –¥–µ—Ñ–∏—Å–æ–≤, –∫–∞–≤—ã—á–µ–∫ –∏ —Ç–∏–ø–æ–≥—Ä–∞—Ñ—Å–∫–∏—Ö —Ç–∏—Ä–µ
            const raw = String(brandModel || '');
            const key = raw
                .toLowerCase()
                .replace(/["'¬´¬ª]/g, '')
                .replace(/[‚Äì‚Äî-]/g, '')
                .replace(/\s+/g, '');
            return key || null;
        }
        
        

        async function getDefaultColorForProduct(productCard) {
            // –ü–æ–ª—É—á–∏—Ç—å –º–æ–¥–µ–ª—å —Ç–æ–≤–∞—Ä–∞ –∏–∑ data-model –∞—Ç—Ä–∏–±—É—Ç–∞
            const variantsElement = productCard.querySelector('.product-variants');
            if (!variantsElement || !variantsElement.dataset.model) return 'Black';
            
            const brandModel = variantsElement.dataset.model;
            
            const modelKey = getModelKey(brandModel);
            if (!modelKey) {
                return 'Black'; // Fallback —Ü–≤–µ—Ç
            }
            
            try {
                const response = await fetch(`/color-schemes/${modelKey}`);
                if (response.ok) {
                    const data = await response.json();
                    return data.default_color || 'Black';
                }
            } catch (error) {
                console.warn('–û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —Ü–≤–µ—Ç–æ–≤–æ–π —Å—Ö–µ–º—ã:', error);
            }
            
            return 'Black'; // Fallback —Ü–≤–µ—Ç
        }
        
        // Show product details
        async function showProductDetails(productId) {
            try {
                showLoading();
                
                // –°–æ—Ö—Ä–∞–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ—Ö–æ–¥–æ–º –∫ —Ç–æ–≤–∞—Ä—É
                currentProductId = productId;
                saveAppState();
                
                const response = await fetch(`${API_BASE}/products/${productId}`);
                const product = await response.json();
                
                // –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∏–∑ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫
                let fullDescription = product.description;
                if (product.specifications && product.specifications.full_description) {
                    fullDescription = product.specifications.full_description;
                }
                
                // –°–æ–∑–¥–∞—Ç—å HTML –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
                const detailsHtml = `
                    <button class="back-button" onclick="loadProducts(${currentCategoryId || 1})">‚Üê –ù–∞–∑–∞–¥ –∫ —Ç–æ–≤–∞—Ä–∞–º</button>
                    <div class="product-details">
                        <div class="product-details-header">
                            <div class="product-details-image">
                                ${product.images && product.images.length > 0 ? 
                                    `<img src="${product.images[0]}" alt="${product.name}" class="details-img">` :
                                    `<div class="details-placeholder">üì±</div>`
                                }
                            </div>
                            <div class="product-details-info">
                                <h1 class="product-details-name">${product.name}</h1>
                                <div class="product-details-brand">${product.brand} ${product.model}</div>
                                <div class="product-details-price">
                                    <span class="current-price">${Math.round(product.price).toLocaleString()} ‚ÇΩ</span>
                                    ${product.old_price > product.price ? 
                                        `<span class="old-price">${Math.round(product.old_price).toLocaleString()} ‚ÇΩ</span>` : ''
                                    }
                                    ${product.discount_percentage > 0 ? 
                                        `<span class="discount">-${Math.round(product.discount_percentage)}%</span>` : ''
                                    }
                                </div>
                                <div class="product-details-sku">SKU: ${product.sku}</div>
                            </div>
                        </div>
                        
                        <div class="product-details-content">
                            <div class="product-description-section">
                                <h3>üìù –û–ø–∏—Å–∞–Ω–∏–µ</h3>
                                <div class="product-full-description">${fullDescription.replace(/\n/g, '<br>')}</div>
                            </div>
                            
                            ${product.specifications ? `
                                <div class="product-specifications-section">
                                    <h3>‚öôÔ∏è –•–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
                                    <div class="specifications-grid">
                                        ${Object.entries(product.specifications)
                                            .filter(([key, value]) => !['full_description', 'variants', 'images', 'image_folder', 'memories', 'colors', 'sim_types', '—Ü–≤–µ—Ç–∞'].includes(key))
                                            .map(([category, details]) => `
                                                <div class="spec-category">
                                                    <h4>${category.charAt(0).toUpperCase() + category.slice(1)}</h4>
                                                    ${typeof details === 'object' ? 
                                                        Object.entries(details).map(([key, value]) => 
                                                            `<div class="spec-item">
                                                                <span class="spec-key">${key.replace(/_/g, ' ')}:</span>
                                                                <span class="spec-value">${Array.isArray(value) ? value.join(', ') : value}</span>
                                                            </div>`
                                                        ).join('') :
                                                        `<div class="spec-item">${details}</div>`
                                                    }
                                                </div>
                                            `).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            
                            <div class="product-actions">
                                <button class="buy-button" onclick="alert('–§—É–Ω–∫—Ü–∏—è –ø–æ–∫—É–ø–∫–∏ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ')">
                                    üõí –ö—É–ø–∏—Ç—å
                                </button>
                                <button class="favorite-button" onclick="alert('–§—É–Ω–∫—Ü–∏—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–æ–∑–∂–µ')">
                                    ‚ù§Ô∏è –í –∏–∑–±—Ä–∞–Ω–Ω–æ–µ
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                
                document.getElementById('content').innerHTML = detailsHtml;
                
            } catch (error) {
                showError('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–µ—Ç–∞–ª–µ–π —Ç–æ–≤–∞—Ä–∞');
            }
        }
        
        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—É—Å–µ–ª—å—é –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        const productImages = {}; // –•—Ä–∞–Ω–∏–ª–∏—â–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞
        
        function changeImage(productId, direction) {
            console.log('changeImage called:', productId, direction);
            const carousel = document.querySelector(`[data-product-id="${productId}"]`);
            if (!carousel) {
                console.log('Carousel not found for product:', productId);
                return;
            }
            
            // –ù–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
            const productCard = carousel.closest('.product-card');
            const variantsContainer = productCard?.querySelector('.product-variants');
            const activeColorButton = variantsContainer?.querySelector('.variant-btn[data-type="color"].active');
            
            let selectedColor = 'Black'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–Ω—ã–π
            
            if (activeColorButton) {
                selectedColor = activeColorButton.dataset.colorFolder || activeColorButton.dataset.value || activeColorButton.dataset.color || 'Black';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ selectedColor –Ω–µ undefined
            if (!selectedColor || selectedColor === 'undefined') {
                selectedColor = 'Black';
            }
            
            // –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const colorImagesKey = `${productId}-${selectedColor}`;
            
            if (!window[colorImagesKey]) {
                // –ï—Å–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —ç—Ç–æ–≥–æ —Ü–≤–µ—Ç–∞ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, —Å–æ–∑–¥–∞—Ç—å –∏—Ö –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
            
            const modelElement = productCard?.querySelector('.product-brand');
            const brandModel = modelElement?.textContent?.trim() || '';
            
            let modelFolder = 'iphone16'; // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –ø–∞–ø–∫–∞
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –ø–∞–ø–∫—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –º–æ–¥–µ–ª–∏
            if (brandModel.includes('16 Pro Max')) {
                modelFolder = 'iphone16promax';
            } else if (brandModel.includes('16 Pro')) {
                modelFolder = 'iphone16pro';
            } else if (brandModel.includes('16')) {
                modelFolder = 'iphone16';
            } else if (brandModel.includes('17 Pro Max')) {
                modelFolder = 'iphone17promax';
            } else if (brandModel.includes('17')) {
                modelFolder = 'iphone17';
            } else if (brandModel.includes('AirPods Pro 2')) {
                modelFolder = 'airpodspro2';
            } else if (brandModel.includes('HomePod mini')) {
                modelFolder = 'HOMEPODmini';
            } else if (brandModel.includes('iPad Air')) {
                modelFolder = 'IPADAir';
            }
            
            // –°–æ–∑–¥–∞–µ–º —Å–ø–∏—Å–æ–∫ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Ç–æ–ª—å–∫–æ —Å –æ–∂–∏–¥–∞–µ–º—ã–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ–º
            const colorImageList = [];
            
            // –û–ø—Ä–µ–¥–µ–ª—è–µ–º –æ–∂–∏–¥–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ü–≤–µ—Ç–∞
            let expectedImageCount = 4; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é 4 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            
            // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞ –¥–ª—è —Ä–∞–∑–Ω—ã—Ö —Ü–≤–µ—Ç–æ–≤ –º–æ–¥–µ–ª–µ–π
            if (selectedColor === 'White' && modelFolder === 'iphone16') {
                expectedImageCount = 3; // iPhone 16 White –∏–º–µ–µ—Ç —Ç–æ–ª—å–∫–æ 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            } else if (selectedColor === 'Silver' && modelFolder === 'iphone17promax') {
                expectedImageCount = 3; // iPhone 17 Pro Max Silver –∏–º–µ–µ—Ç 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            } else if (selectedColor === 'Deep Blue' && modelFolder === 'iphone17promax') {
                expectedImageCount = 3; // iPhone 17 Pro Max Deep Blue –∏–º–µ–µ—Ç 3 –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            }
            
            // –°–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ü–≤–µ—Ç–æ–≤ –∏–∑ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö —Å –Ω–∞–∑–≤–∞–Ω–∏—è–º–∏ –ø–∞–ø–æ–∫
            const colorFolderMapping = {
                'Teal': 'teal',
                'Pink': 'pink', 
                'White': 'white',
                'Black': 'black',
                'Default': 'black', // –î–µ—Ñ–æ–ª—Ç–Ω—ã–π —Ü–≤–µ—Ç
                'Titanium White': 'titanium-white',
                'Titanium Blue': 'titanium-blue', 
                'Titanium Natural': 'titanium-natural',
                'Titanium Black': 'titanium-black',
                'Titanium Desert': 'titanium-desert',
                'Space Black': 'space-black',
                'Silver': 'silver',
                'Deep Blue': 'deep-blue',
                'Cosmic Orange': 'cosmic-orange'
            };
            
            // –ü–æ–ª—É—á–∞–µ–º –ø—Ä–∞–≤–∏–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –ø–∞–ø–∫–∏ –¥–ª—è —Ü–≤–µ—Ç–∞
            const colorFolder = colorFolderMapping[selectedColor] || selectedColor.toLowerCase();
            
            // –°–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä–∏–º –µ—Å—Ç—å –ª–∏ —É–∂–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –≤ cache –æ—Ç updateProductImage
            let cachedImages = window[colorImagesKey];
            if (cachedImages && cachedImages.length > 0) {
                console.log(`üì∏ –ò—Å–ø–æ–ª—å–∑—É–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ cache –¥–ª—è ${selectedColor}:`, cachedImages);
                colorImageList = cachedImages;
            } else {
                // –ï—Å–ª–∏ –Ω–µ—Ç cached –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π, –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ–º –∏–∑ API
                console.log('üì∏ –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ API...');
                
                let modelKey = 'iphone16promax'; // –î–µ—Ñ–æ–ª—Ç–Ω–∞—è –ø–∞–ø–∫–∞
                if (brandModel.includes('16 Pro Max')) {
                    modelKey = 'iphone16promax';
                } else if (brandModel.includes('17 Pro Max')) {
                    modelKey = 'iphone17promax';
                }
                
                fetch(`/product-images/${modelKey}/${colorFolder}`)
                    .then(response => response.json())
                    .then(data => {
                        const timestampedImages = data.image_paths.map(img => `${img}?v=${Date.now()}`);
                        window[colorImagesKey] = timestampedImages;
                        console.log(`üì∏ –ü–æ–ª—É—á–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–∑ API –¥–ª—è ${selectedColor}:`, timestampedImages);
                    })
                    .catch(error => {
                        console.error(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –¥–ª—è ${selectedColor}:`, error);
                        // Fallback –Ω–∞ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ
                        for (let i = 1; i <= expectedImageCount; i++) {
                            colorImageList.push(`/static/images/products/${modelFolder}/${colorFolder}/${i}.jpg`);
                        }
            const timestampedImages = colorImageList.map(img => `${img}?v=${Date.now()}`);
            window[colorImagesKey] = timestampedImages;
                    });
            }
            }
            
            const indicators = carousel.querySelectorAll('.indicator');
            const currentActive = carousel.querySelector('.indicator.active');
            const currentIndex = parseInt(currentActive.dataset.index);
            
            let newIndex = currentIndex + direction;
            
            // –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            if (newIndex < 0) {
                newIndex = indicators.length - 1;
            } else if (newIndex >= indicators.length) {
                newIndex = 0;
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            const currentColorImages = window[colorImagesKey];
            if (newIndex >= currentColorImages.length) {
                console.log(`Index ${newIndex} is out of range for color ${selectedColor} (only ${currentColorImages.length} images), adjusting...`);
                newIndex = Math.max(0, currentColorImages.length - 1); // –ø–µ—Ä–µ–π—Ç–∏ –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –¥–æ—Å—Ç—É–ø–Ω–æ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
            }
            
            console.log('Changing from index', currentIndex, 'to', newIndex);
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            currentActive.classList.remove('active');
            indicators[newIndex].classList.add('active');
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏—Å–ø–æ–ª—å–∑—É—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
            const img = carousel.querySelector('.product-img');
            const activeColorImages = window[colorImagesKey];
            
            if (activeColorImages && activeColorImages[newIndex]) {
                console.log('Changing image to:', activeColorImages[newIndex], 'color:', selectedColor);
                img.src = activeColorImages[newIndex];
            } else {
                console.log('No image found for product:', productId, 'index:', newIndex, 'color:', selectedColor);
                console.log('Available color images:', activeColorImages);
                
                // Fallback: –ø–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å –ø–µ—Ä–≤–æ–µ –¥–æ—Å—Ç—É–ø–Ω–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–ª–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–∑ –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞
                const firstImage = activeColorImages && activeColorImages.length > 0 ? activeColorImages[0] : null;
                const defaultImages = window[`${productId}-Black`];
                const fallbackImage = firstImage || (defaultImages && defaultImages[0]);
                
                if (fallbackImage) {
                    console.log('Using fallback image:', fallbackImage);
                    img.src = fallbackImage;
                } else {
                    console.warn('No fallback image available for product:', productId);
                }
            }
        }
        
        // –ù–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–º–µ–Ω—ã –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π —Å–ª–∞–π–¥–∞
        function changeImageWithSlide(productId, direction) {
            const carousel = document.querySelector(`[data-product-id="${productId}"]`);
            if (!carousel) {
                return;
            }
            
            // –ù–∞–π—Ç–∏ –∫–∞—Ä—Ç–æ—á–∫—É —Ç–æ–≤–∞—Ä–∞ –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
            const productCard = carousel.closest('.product-card');
            const variantsContainer = productCard?.querySelector('.product-variants');
            const activeColorButton = variantsContainer?.querySelector('.variant-btn[data-type="color"].active');
            
            let selectedColor = 'Black'; // –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é —á–µ—Ä–Ω—ã–π
            
            if (activeColorButton) {
                selectedColor = activeColorButton.dataset.colorFolder || activeColorButton.dataset.value || activeColorButton.dataset.color || 'Black';
            }
            
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º —á—Ç–æ selectedColor –Ω–µ undefined
            if (!selectedColor || selectedColor === 'undefined') {
                selectedColor = 'Black';
            }
            
            // –°–æ–∑–¥–∞—Ç—å –∫–ª—é—á –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ —Ü–≤–µ—Ç–∞ –∏ –ø–æ–ª—É—á–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
            const colorImagesKey = `${productId}-${selectedColor}`;
            
            // –ü–æ–ª—É—á–∞–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞
            const activeColorImages = window[colorImagesKey];
            
            if (!activeColorImages || activeColorImages.length === 0) {
                return;
            }
            
            const indicators = carousel.querySelectorAll('.indicator');
            const currentActive = carousel.querySelector('.indicator.active');
            const currentIndex = parseInt(currentActive.dataset.index);
            
            let newIndex = currentIndex + direction;
            
            // –¶–∏–∫–ª–∏—á–µ—Å–∫–æ–µ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –≤ –ø—Ä–µ–¥–µ–ª–∞—Ö –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
            if (newIndex < 0) {
                newIndex = indicators.length - 1;
            } else if (newIndex >= indicators.length) {
                newIndex = 0;
            }
            
            // –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞: —É–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ —Ü–≤–µ—Ç–∞ —ç—Ç–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            if (newIndex >= activeColorImages.length) {
                console.log(`Index ${newIndex} is out of range for color ${selectedColor} (only ${activeColorImages.length} images), adjusting...`);
                newIndex = Math.max(0, activeColorImages.length - 1);
            }
            
            console.log('Changing from index', currentIndex, 'to', newIndex);
            
            // –°–æ–∑–¥–∞–µ–º –∏–ª–∏ –ø–æ–ª—É—á–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è —Å–ª–∞–π–¥–æ–≤
            let slideContainer = carousel.querySelector('.image-slide-container');
            if (!slideContainer) {
                // –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–ª—è —Å–ª–∞–π–¥–æ–≤
                const currentImg = carousel.querySelector('.product-img');
                if (currentImg) {
                    slideContainer = document.createElement('div');
                    slideContainer.className = 'image-slide-container';
                    
                    const slideWrapper = document.createElement('div');
                    slideWrapper.className = 'image-slide-wrapper';
                    slideWrapper.style.transform = `translateX(-${currentIndex * 100}%)`;
                    
                    // –°–æ–∑–¥–∞–µ–º —Å–ª–∞–π–¥—ã –¥–ª—è –≤—Å–µ—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                    activeColorImages.forEach((imageSrc, index) => {
                        const slideItem = document.createElement('div');
                        slideItem.className = 'image-slide-item';
                        if (index === currentIndex) {
                            slideItem.classList.add('fade-in');
                        }
                        
                        const img = document.createElement('img');
                        img.src = imageSrc;
                        img.alt = `Product image ${index + 1}`;
                        img.style.opacity = index === currentIndex ? '1' : '0';
                        
                        slideItem.appendChild(img);
                        slideWrapper.appendChild(slideItem);
                    });
                    
                    slideContainer.appendChild(slideWrapper);
                    
                    // –ó–∞–º–µ–Ω—è–µ–º —Å—Ç–∞—Ä–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ –Ω–æ–≤—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É
                    currentImg.parentNode.replaceChild(slideContainer, currentImg);
                }
            }
            
            if (slideContainer) {
                const slideWrapper = slideContainer.querySelector('.image-slide-wrapper');
                const slideItems = slideContainer.querySelectorAll('.image-slide-item');
                
                // –ê–Ω–∏–º–∞—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞
                slideWrapper.style.transition = 'transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)';
                slideWrapper.style.transform = `translateX(-${newIndex * 100}%)`;
                
                // –û–±–Ω–æ–≤–ª—è–µ–º –≤–∏–¥–∏–º–æ—Å—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
                slideItems.forEach((item, index) => {
                    const img = item.querySelector('img');
                    if (index === newIndex) {
                        img.style.opacity = '1';
                        item.classList.add('fade-in');
                        item.classList.remove('fade-out');
                    } else {
                        img.style.opacity = '0';
                        item.classList.remove('fade-in');
                        if (index === currentIndex) {
                            item.classList.add('fade-out');
                        }
                    }
                });
                
                // –£–±–∏—Ä–∞–µ–º –∫–ª–∞—Å—Å fade-out –ø–æ—Å–ª–µ –∞–Ω–∏–º–∞—Ü–∏–∏
                setTimeout(() => {
                    slideItems.forEach(item => {
                        item.classList.remove('fade-out');
                    });
                }, 300);
            }
            
            // –û–±–Ω–æ–≤–∏—Ç—å –∞–∫—Ç–∏–≤–Ω—ã–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä
            currentActive.classList.remove('active');
            indicators[newIndex].classList.add('active');
        }
        
        // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤ —Ç–æ–ª—å–∫–æ –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
        function addSwipeSupport() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            const isMobile = window.innerWidth <= 768 || 
                            ('ontouchstart' in window) ||
                            /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (!isMobile) {
                console.log('Desktop device detected, skipping swipe support');
                return;
            }
            
            const carousels = document.querySelectorAll('.product-image-carousel');
            
            carousels.forEach(carousel => {
                // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –µ—â–µ –Ω–µ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                if (carousel.dataset.swipeInitialized === 'true') {
                    return;
                }
                
                let startX = 0;
                let startY = 0;
                let endX = 0;
                let endY = 0;
                let isSwipe = false;
                
                const handleTouchStart = (e) => {
                    startX = e.touches[0].clientX;
                    startY = e.touches[0].clientY;
                    isSwipe = false;
                };
                
                const handleTouchMove = (e) => {
                    if (!isSwipe) {
                        endX = e.touches[0].clientX;
                        endY = e.touches[0].clientY;
                        
                        const deltaX = Math.abs(endX - startX);
                        const deltaY = Math.abs(endY - startY);
                        
                        // –û–ø—Ä–µ–¥–µ–ª—è–µ–º, —á—Ç–æ —ç—Ç–æ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–≤–∞–π–ø
                        if (deltaX > deltaY && deltaX > 30) {
                            isSwipe = true;
                        }
                    }
                };
                
                const handleTouchEnd = (e) => {
                    if (isSwipe) {
                        const deltaX = endX - startX;
                        const productId = carousel.dataset.productId;
                        
                        if (Math.abs(deltaX) > 20) { // –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Å–≤–∞–π–ø–∞
                            if (deltaX > 0) {
                                // –°–≤–∞–π–ø –≤–ø—Ä–∞–≤–æ - –ø—Ä–µ–¥—ã–¥—É—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                changeImageWithSlide(parseInt(productId), -1);
                            } else {
                                // –°–≤–∞–π–ø –≤–ª–µ–≤–æ - —Å–ª–µ–¥—É—é—â–µ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                                changeImageWithSlide(parseInt(productId), 1);
                            }
                        }
                    }
                };
                
                carousel.addEventListener('touchstart', handleTouchStart, { passive: true });
                carousel.addEventListener('touchmove', handleTouchMove, { passive: true });
                carousel.addEventListener('touchend', handleTouchEnd, { passive: true });
                
                // –û—Ç–º–µ—á–∞–µ–º, —á—Ç–æ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã
                carousel.dataset.swipeInitialized = 'true';
            });
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–≤–∞–π–ø–æ–≤ –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        function initializeSwipeSupport() {
            // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ —ç—Ç–æ –º–æ–±–∏–ª—å–Ω–æ–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ
            const isMobile = window.innerWidth <= 768 || 
                            ('ontouchstart' in window) ||
                            /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
            
            if (!isMobile) {
                console.log('Desktop device detected, swipe support disabled');
                return;
            }
            
            console.log('Initializing swipe support for mobile device');
            
            // –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥–¥–µ—Ä–∂–∫—É —Å–≤–∞–π–ø–æ–≤ –¥–ª—è —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π
            addSwipeSupport();
            
            // –ù–∞–±–ª—é–¥–∞—Ç–µ–ª—å –∑–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è–º–∏ DOM –¥–ª—è –Ω–æ–≤—ã—Ö –∫–∞—Ä—É—Å–µ–ª–µ–π
            const observer = new MutationObserver((mutations) => {
                mutations.forEach((mutation) => {
                    if (mutation.type === 'childList') {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1) { // Element node
                                if (node.classList && node.classList.contains('product-image-carousel')) {
                                    addSwipeSupport();
                                } else if (node.querySelectorAll) {
                                    const newCarousels = node.querySelectorAll('.product-image-carousel');
                                    if (newCarousels.length > 0) {
                                        addSwipeSupport();
                                    }
                                }
                            }
                        });
                    }
                });
            });
            
            observer.observe(document.body, {
                childList: true,
                subtree: true
            });
        }
        
        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
        async function checkAndFilterImages(colorImages, timestampedImages) {
            const existingImages = [];
            
            for (let i = 0; i < colorImages.length; i++) {
                try {
                    // –ü–æ–ø—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
                    await new Promise((resolve, reject) => {
                        const img = new Image();
                        img.onload = () => resolve(colorImages[i]);
                        img.onerror = () => reject(new Error('Image not found'));
                        img.src = colorImages[i];
                    });
                    existingImages.push(timestampedImages[i]);
                } catch (error) {
                    // –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç, –ø—Ä–æ–ø—É—Å–∫–∞–µ–º
                    console.log(`Image ${i+1} not found for this color, skipping`);
                    break; // –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞–µ–º —á—Ç–æ –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–µ–≥–æ –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–æ–∂–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç
                }
            }
            
            return existingImages;
        }
        
        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ç–æ–≤–∞—Ä–∞ –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        function storeProductImages(product) {
            if (product.images && product.images.length > 0) {
                productImages[product.id] = product.images;
                console.log('Stored images for product', product.id, ':', product.images);
            } else {
                console.log('No images for product', product.id);
            }
        }
        
        // Show loading state
        function showLoading() {
            document.getElementById('content').innerHTML = '<div class="loading">–ó–∞–≥—Ä—É–∑–∫–∞...</div>';
        }
        
        // Hide loading state - just clear loading indicator
        function hideLoading() {
            // Loading —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –æ—á–∏—â–∞—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–≥–¥–∞ –∫–æ–Ω—Ç–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è
            // –≠—Ç–∞ —Ñ—É–Ω–∫—Ü–∏—è —Å–ª—É–∂–∏—Ç –∫–∞–∫ placeholder –Ω–∞ —Å–ª—É—á–∞–π –µ—Å–ª–∏ –Ω—É–∂–Ω–æ —è–≤–Ω–æ —Å–∫—Ä—ã—Ç—å loading
        }
        
        // Show error state
        function showError(message) {
            document.getElementById('content').innerHTML = `<div class="error">${message}</div>`;
        }
        
        // Telegram WebApp integration
        // –°–æ–∑–¥–∞–Ω–∏–µ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
        function createBreadcrumbs(brand = null) {
            let breadcrumbs = [];
            
            // –î–æ–º–∞—à–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
            breadcrumbs.push(`
                <div class="breadcrumb-item">
                    <a href="javascript:void" class="breadcrumb-link" onclick="loadCategories()">–ö–∞—Ç–µ–≥–æ—Ä–∏–∏</a>
                </div>
            `);
            
            // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Ç–µ–≥–æ—Ä–∏—é (level0) - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—É—é
            if (currentLevel0Filter) {
                breadcrumbs.push(`
                    <span class="breadcrumb-separator">‚Üí</span>
                    <div class="breadcrumb-item">
                        <a href="javascript:void" class="breadcrumb-link" onclick="navigateToLevel0()">${currentLevel0Filter}</a>
                    </div>
                `);
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º –±—Ä–µ–Ω–¥ - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –µ—Å–ª–∏ –µ—Å—Ç—å level1 –∏–ª–∏ level2
            if (brand) {
                const isClickable = currentLevel1Filter || currentLevel2Filter;
                if (isClickable) {
                    breadcrumbs.push(`
                        <span class="breadcrumb-separator">‚Üí</span>
                        <div class="breadcrumb-item">
                            <a href="javascript:void" class="breadcrumb-link" onclick="navigateToBrand('${brand}')">${brand}</a>
                        </div>
                    `);
                } else {
                    breadcrumbs.push(`
                        <span class="breadcrumb-separator">‚Üí</span>
                        <div class="breadcrumb-item">
                            <span class="breadcrumb-current">${brand}</span>
                        </div>
                    `);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å 1 - –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π –µ—Å–ª–∏ –µ—Å—Ç—å level2
            if (currentLevel1Filter) {
                const isClickable = currentLevel2Filter !== null;
                if (isClickable) {
                    breadcrumbs.push(`
                        <span class="breadcrumb-separator">‚Üí</span>
                        <div class="breadcrumb-item">
                            <a href="javascript:void" class="breadcrumb-link" onclick="navigateToLevel1('${currentLevel1Filter}')">${currentLevel1Filter}</a>
                        </div>
                    `);
                } else {
                    breadcrumbs.push(`
                        <span class="breadcrumb-separator">‚Üí</span>
                        <div class="breadcrumb-item">
                            <span class="breadcrumb-current">${currentLevel1Filter}</span>
                        </div>
                    `);
                }
            }
            
            // –î–æ–±–∞–≤–ª—è–µ–º —É—Ä–æ–≤–µ–Ω—å 2 - –≤—Å–µ–≥–¥–∞ —Ç–µ–∫—É—â–∏–π (–Ω–µ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–π)
            if (currentLevel2Filter) {
                breadcrumbs.push(`
                    <span class="breadcrumb-separator">‚Üí</span>
                    <div class="breadcrumb-item">
                        <span class="breadcrumb-current">${currentLevel2Filter}</span>
                    </div>
                `);
            }
            
            return `
                <div class="breadcrumb-trail">
                    ${breadcrumbs.join('')}
                </div>
            `;
        }
        
        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ö–ª–µ–±–Ω—ã—Ö –∫—Ä–æ—à–µ–∫
        function updateBreadcrumbs() {
            const breadcrumbsContainer = document.getElementById('breadcrumbsContainer');
            if (breadcrumbsContainer) {
                breadcrumbsContainer.innerHTML = createBreadcrumbs(currentBrandFilter);
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ —É—Ä–æ–≤–Ω—é level0 (–∫–∞—Ç–µ–≥–æ—Ä–∏–∏)
        async function navigateToLevel0() {
            if (currentCategoryId && currentCategoryName) {
                // –ó–∞–≥—Ä—É–∂–∞–µ–º –±—Ä–µ–Ω–¥—ã —Ç–µ–∫—É—â–µ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
                await loadSubcategories(currentCategoryId);
            } else {
                // Fallback: –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –≥–ª–∞–≤–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–π
                loadCategories();
            }
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ –±—Ä–µ–Ω–¥—É (—Å–±—Ä–æ—Å level1 –∏ level2)
        async function navigateToBrand(brand) {
            currentLevel1Filter = null;
            currentLevel2Filter = null;
            await loadFilteredProducts();
            updateBreadcrumbs();
            await createHierarchyFilters(currentBrandFilter, []);
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ level1 (—Å–±—Ä–æ—Å level2)
        async function navigateToLevel1(level1Value) {
            currentLevel1Filter = level1Value;
            currentLevel2Filter = null;
            await loadFilteredProducts();
            updateBreadcrumbs();
            await createHierarchyFilters(currentBrandFilter, []);
        }
        
        // –ù–∞–≤–∏–≥–∞—Ü–∏—è –∫ level2
        async function navigateToLevel2(level2Value) {
            currentLevel2Filter = level2Value;
            await loadFilteredProducts();
            updateBreadcrumbs();
            await createHierarchyFilters(currentBrandFilter, []);
        }

        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
        }

        // About modal controls
        function openAboutModal() {
            const el = document.getElementById('aboutBackdrop');
            if (el) el.style.display = 'flex';
        }
        function closeAboutModal() {
            const el = document.getElementById('aboutBackdrop');
            if (el) el.style.display = 'none';
        }
        function backdropAboutClick(event) {
            if (event.target && event.target.id === 'aboutBackdrop') {
                closeAboutModal();
            }
        }
    </script>
</body>
</html>

