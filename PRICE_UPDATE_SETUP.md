# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω

–≠—Ç–æ—Ç –¥–æ–∫—É–º–µ–Ω—Ç –æ–ø–∏—Å—ã–≤–∞–µ—Ç, –∫–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∏–∑ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç.

## –í–∞—Ä–∏–∞–Ω—Ç 1: Systemd Timer (Linux, —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞)

### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã —Å–µ—Ä–≤–∏—Å–∞ –∏ —Ç–∞–π–º–µ—Ä–∞
sudo cp price_updater.service /etc/systemd/system/
sudo cp price_updater.timer /etc/systemd/system/

# –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã, —É–∫–∞–∑–∞–≤ –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—É—Ç–∏ –∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
sudo nano /etc/systemd/system/price_updater.service
# –£–∫–∞–∂–∏—Ç–µ:
# - User=–≤–∞—à_–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å
# - WorkingDirectory=–ø–æ–ª–Ω—ã–π_–ø—É—Ç—å_–∫_–ø—Ä–æ–µ–∫—Ç—É
# - ExecStart=–ø—É—Ç—å_–∫_python3 –∏ –ø—É—Ç—å_–∫_—Å–∫—Ä–∏–ø—Ç—É
# - Environment –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ (DATABASE_URL, PRICE_SERVICE_URL, PRICE_SERVICE_TOKEN)

# –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å systemd
sudo systemctl daemon-reload

# –í–∫–ª—é—á–∏—Ç—å –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å —Ç–∞–π–º–µ—Ä
sudo systemctl enable price_updater.timer
sudo systemctl start price_updater.timer

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
sudo systemctl status price_updater.timer
sudo systemctl status price_updater.service
```

### 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤

```bash
# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤
sudo journalctl -u price_updater.service -f
# –∏–ª–∏
cat /var/log/price_updater.log
cat /var/log/price_updater_error.log
```

## –í–∞—Ä–∏–∞–Ω—Ç 2: Cron (—É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π, —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –≤—Å–µ—Ö —Å–∏—Å—Ç–µ–º–∞—Ö)

### –ù–∞—Å—Ç—Ä–æ–π–∫–∞ cron

```bash
# –û—Ç–∫—Ä—ã—Ç—å crontab
crontab -e

# –î–æ–±–∞–≤–∏—Ç—å —Å—Ç—Ä–æ–∫—É (–∑–∞–ø—É—Å–∫ –∫–∞–∂–¥—ã–µ 30 –º–∏–Ω—É—Ç):
*/30 * * * * cd /path/to/yo_mini_app && /usr/bin/python3 update_prices_from_service.py >> /var/log/price_updater.log 2>&1

# –ò–ª–∏ —Å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏ –æ–∫—Ä—É–∂–µ–Ω–∏—è:
*/30 * * * * cd /path/to/yo_mini_app && DATABASE_URL="sqlite:///electronics_store.db" PRICE_SERVICE_URL="http://localhost:8005/api/prices" PRICE_SERVICE_TOKEN="your-token" /usr/bin/python3 update_prices_from_service.py >> /var/log/price_updater.log 2>&1
```

## –í–∞—Ä–∏–∞–Ω—Ç 3: –ó–∞–ø—É—Å–∫ –≤—Ä—É—á–Ω—É—é –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
export DATABASE_URL="sqlite:///electronics_store.db"
export PRICE_SERVICE_URL="http://localhost:8005/api/prices"
export PRICE_SERVICE_TOKEN="your-token"  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –µ—Å–ª–∏ —Ç—Ä–µ–±—É–µ—Ç—Å—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

# –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–∫—Ä–∏–ø—Ç
python3 update_prices_from_service.py
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞

### –§–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –∫ API

–°–∫—Ä–∏–ø—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç POST –∑–∞–ø—Ä–æ—Å –∫ —Å–µ—Ä–≤–∏—Å—É —Å –º–∞—Å—Å–∏–≤–æ–º SKU:

**–ó–∞–ø—Ä–æ—Å:**
```bash
curl -X POST "http://localhost:8005/api/prices" \
  -H "Content-Type: application/json" \
  -d '{"skus": ["17 Pro Max 256GB Orange Dual eSIM", "17 256GB White SIM"]}'
```

**–ò–ª–∏ —á–µ—Ä–µ–∑ Python:**
```python
import requests

response = requests.post(
    "http://localhost:8005/api/prices",
    json={"skus": ["17 Pro Max 256GB Orange Dual eSIM", "17 256GB White SIM"]}
)
prices = response.json()
```

### –¢—Ä–µ–±—É–µ–º—ã–π —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ API

–°–µ—Ä–≤–∏—Å –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å JSON –≤ —Å–ª–µ–¥—É—é—â–µ–º —Ñ–æ—Ä–º–∞—Ç–µ:

```json
{
  "prices": {
    "17 Pro Max 256GB Orange Dual eSIM": {
      "price": 150000.0,
      "name": "17 Pro Max 256GB Orange Dual eSIM"
    },
    "17 256GB White SIM": {
      "price": 120000.0,
      "name": "17 256GB White SIM"
    }
  }
}
```

**–í–∞–∂–Ω–æ:**
- –ö–ª—é—á –æ–±—ä–µ–∫—Ç–∞ `prices` - —ç—Ç–æ SKU —Ç–æ–≤–∞—Ä–∞ (—Å—Ç—Ä–æ–∫–∞)
- –ó–Ω–∞—á–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –æ–±—ä–µ–∫—Ç–æ–º —Å –ø–æ–ª–µ–º `price` (—á–∏—Å–ª–æ, –æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ–µ)
- –ü–æ–ª–µ `name` –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

### –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

–ï—Å–ª–∏ –≤–∞—à —Å–µ—Ä–≤–∏—Å —Ç—Ä–µ–±—É–µ—Ç –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é, —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:

```bash
export PRICE_SERVICE_TOKEN="your-api-token"
```

–í —Å–∫—Ä–∏–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Bearer —Ç–æ–∫–µ–Ω. –ï—Å–ª–∏ –Ω—É–∂–µ–Ω –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç, –∏–∑–º–µ–Ω–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `get_prices_from_service()`.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø—É—Å–∫–∏ (systemd timer)
systemctl list-timers price_updater.timer

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏
tail -f /var/log/price_updater.log
```

### –ü—Ä–∏–º–µ—Ä—ã –≤—ã–≤–æ–¥–∞

```
üîÑ –ù–∞—á–∞–ª–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Ü–µ–Ω - 2024-01-15 14:30:00
üì° –ü–æ–ª—É—á–µ–Ω–∏–µ —Ü–µ–Ω –∏–∑ —Å–µ—Ä–≤–∏—Å–∞: https://your-service.com/api/prices
üì¶ –ü–æ–ª—É—á–µ–Ω–æ 150 –∑–∞–ø–∏—Å–µ–π —Ü–µ–Ω
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞ –¥–ª—è SKU-001: 99900.0 ‚Üí 94900.0 RUB
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Ü–µ–Ω–∞ –¥–ª—è SKU-002: 149900.0 ‚Üí 149900.0 RUB
...

üìä –ò—Ç–æ–≥–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:
   –û–±–Ω–æ–≤–ª–µ–Ω–æ: 145
   –°–æ–∑–¥–∞–Ω–æ: 5
   –ù–µ –Ω–∞–π–¥–µ–Ω–æ –ø—Ä–æ–¥—É–∫—Ç–æ–≤: 0
   –û—à–∏–±–æ–∫: 0
‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ü–µ–Ω –∑–∞–≤–µ—Ä—à–µ–Ω–æ —É—Å–ø–µ—à–Ω–æ
```

## –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∫—Ä–∏–ø—Ç—É**
   ```bash
   chmod +x update_prices_from_service.py
   ```

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ë–î**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø—É—Ç—å –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É –ë–î

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–Ω–µ—à–Ω–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞**
   ```bash
   curl -H "Authorization: Bearer YOUR_TOKEN" https://your-service.com/api/prices
   ```

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –æ—à–∏–±–æ–∫**
   ```bash
   tail -100 /var/log/price_updater_error.log
   ```


